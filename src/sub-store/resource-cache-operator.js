(()=>{(()=>{"use strict";var b={};const u=$substore;class _{constructor(t,e){this.expires=e;const s=u.read(t);s?this.resourceCache=JSON.parse(s):(this.resourceCache={},this._persist()),this._cleanup()}_cleanup(){let t=!1;const e=new Date().getTime();Object.keys(this.resourceCache).forEach(s=>{const n=this.resourceCache[s];(!n.time||e-n.time>this.expires)&&(delete this.resourceCache[s],u.delete(`#${s}`),t=!0)}),t&&this._persist()}revokeIds(t){let e=!1;for(const s of t)delete this.resourceCache[s],e=!0;e&&this._persist()}revokeAll(){this.resourceCache={},this._persist()}_persist(){u.write(JSON.stringify(this.resourceCache),key)}get(t){const e=this.resourceCache[t]&&this.resourceCache[t].time;return e&&new Date().getTime()-e<=this.expires?this.resourceCache[t].data:null}set(t,e){this.resourceCache[t]={time:new Date().getTime(),data:e},this._persist()}}const m=_;var v=(r,t,e)=>new Promise((s,n)=>{var c=i=>{try{a(e.next(i))}catch(o){n(o)}},h=i=>{try{a(e.throw(i))}catch(o){n(o)}},a=i=>i.done?s(i.value):Promise.resolve(i.value).then(c,h);a((e=e.apply(r,t)).next())});const C=$substore;function f(r){return!!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(r)}function E(r){return!!/^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)(\/([1-9]|[1-2][0-9]|3[0-2])){0,1}$/.test(r)}function k(r,t){const e=r.split("."),s=t.split(".");if(e.length<3||s.length<3)return!1;for(let n=0;n<3;n++)if(e[n]!==s[n])return!1;return!0}function P(r){const t=r.split(".");return t[t.length-1]}function w(r){return v(this,null,function*(){return yield C.http.get(`https://dns.google/resolve?name=${r}`).then(e=>{const s=JSON.parse(e.body);if(s.Status===0){const n=s.Answer.find(c=>c.type===1);return n?n.data:""}return""})})}function O(r,t){let e,s,n=p(r);if((e=t.match(/^(.*?)\/(\d{1,2})$/))&&(s=p(e[1]))>=0){const c=Math.pow(2,32-parseInt(e[2]));return n>=s&&n<=s+c-1}else return!1}function p(r){let t;if(t=r.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let e=0,s=1;for(let n=4;n>=1;n-=1)e+=s*parseInt(t[n]),s*=256;return e}else return-1}var d=(r,t,e)=>new Promise((s,n)=>{var c=i=>{try{a(e.next(i))}catch(o){n(o)}},h=i=>{try{a(e.throw(i))}catch(o){n(o)}},a=i=>i.done?s(i.value):Promise.resolve(i.value).then(c,h);a((e=e.apply(r,t)).next())});const y="#sub-store-cached-dns",g=7*24*60*60*1e3,l=new m(y,g);function I(r){return d(this,null,function*(){const t=r.filter(e=>f(e.server)).map(e=>e.server);t.length>0&&l.revokeIds(t);for(const e of t)yield $(e);return r})}function $(r){return d(this,null,function*(){if(f(r)&&!l.get(r)){const e=yield w(r);e&&l.set(r,e)}})}window.operator=I})();})();
