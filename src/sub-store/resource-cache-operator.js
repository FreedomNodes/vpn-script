"use strict";(()=>{const l=$substore;class d{constructor(t,e){this.expires=e;const s=l.read(t);s?this.resourceCache=JSON.parse(s):(this.resourceCache={},this._persist()),this._cleanup()}_cleanup(){let t=!1;const e=new Date().getTime();Object.keys(this.resourceCache).forEach(s=>{const i=this.resourceCache[s];(!i.time||e-i.time>this.expires)&&(delete this.resourceCache[s],l.delete(`#${s}`),t=!0)}),t&&this._persist()}revokeIds(t){let e=!1;for(const s of t)delete this.resourceCache[s],e=!0;e&&this._persist()}revokeAll(){this.resourceCache={},this._persist()}_persist(){l.write(JSON.stringify(this.resourceCache),key)}get(t){const e=this.resourceCache[t]&&this.resourceCache[t].time;return e&&new Date().getTime()-e<=this.expires?this.resourceCache[t].data:null}set(t,e){this.resourceCache[t]={time:new Date().getTime(),data:e},this._persist()}}const _=d;var m=(r,t,e)=>new Promise((s,i)=>{var o=n=>{try{c(e.next(n))}catch(a){i(a)}},u=n=>{try{c(e.throw(n))}catch(a){i(a)}},c=n=>n.done?s(n.value):Promise.resolve(n.value).then(o,u);c((e=e.apply(r,t)).next())});const v=$substore;function f(r){return!!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(r)}function C(r){return m(this,null,function*(){return yield v.http.get(`https://dns.google/resolve?name=${r}`).then(e=>{const s=JSON.parse(e.body);if(s.Status===0){const i=s.Answer.find(o=>o.type===1);return i?i.data:""}return""})})}var p=(r,t,e)=>new Promise((s,i)=>{var o=n=>{try{c(e.next(n))}catch(a){i(a)}},u=n=>{try{c(e.throw(n))}catch(a){i(a)}},c=n=>n.done?s(n.value):Promise.resolve(n.value).then(o,u);c((e=e.apply(r,t)).next())});const w="#sub-store-cached-dns",y=7*24*60*60*1e3,h=new _(w,y);function g(r){return p(this,null,function*(){const t=r.filter(e=>f(e.server)).map(e=>e.server);t.length>0&&h.revokeIds(t);for(const e of t)yield I(e);return r})}function I(r){return p(this,null,function*(){if(f(r)&&!h.get(r)){const e=yield C(r);e&&h.set(r,e)}})}window.operator=g;})();
