/*
 fullhash:164ad9a81da617ed8b41, chunkhash:4ebdc42766b0e5460e1b, file:sub-store/sni-operator.js
 author: Kien Tran
 */
(()=>{(()=>{"use strict";var k={3183:(f,c,n)=>{var _;typeof window!="undefined"?_=window:typeof n.g!="undefined"?_=n.g:typeof self!="undefined"?_=self:_={},f.exports=_},8475:(f,c,n)=>{n.d(c,{A:()=>a});const _=$substore;class h{constructor(r,o){this.key=r,this.expires=o;const i=_.read(r);i?this.resourceCache=JSON.parse(i):(this.resourceCache={},this._persist()),this._cleanup()}_cleanup(){let r=!1;const o=new Date().getTime();Object.keys(this.resourceCache).forEach(i=>{const v=this.resourceCache[i];(!v.time||o-v.time>this.expires)&&(delete this.resourceCache[i],_.delete(`#${i}`),r=!0)}),r&&this._persist()}revokeIds(r){let o=!1;for(const i of r)delete this.resourceCache[i],o=!0;o&&this._persist()}revokeAll(){this.resourceCache={},this._persist()}_persist(){_.write(JSON.stringify(this.resourceCache),this.key)}get(r){const o=this.resourceCache[r]&&this.resourceCache[r].time;return o&&new Date().getTime()-o<=this.expires?this.resourceCache[r].data:null}set(r,o){this.resourceCache[r]={time:new Date().getTime(),data:o},this._persist()}}const a=h},423:(f,c,n)=>{n.d(c,{ru:()=>h});var _=(r,o,i)=>new Promise((v,I)=>{var m=O=>{try{S(i.next(O))}catch(T){I(T)}},A=O=>{try{S(i.throw(O))}catch(T){I(T)}},S=O=>O.done?v(O.value):Promise.resolve(O.value).then(m,A);S((i=i.apply(r,o)).next())});function h(){return _(this,null,function*(){const r=yield produceArtifact({type:"file",name:"proxy_config"});return ProxyUtils.yaml.safeLoad(r)})}function a(){return _(this,null,function*(){const r=yield produceArtifact({type:"file",name:"subscription_config"});return ProxyUtils.yaml.safeLoad(r)})}function P(r){return _(this,null,function*(){const o=normalizeString(r),i=yield a();let v="";for(const I in i)if(containsIgnoreCase(o,normalizeString(I))){v=I;break}return i[v]})}},1500:(f,c,n)=>{n.d(c,{Dq:()=>P,Mi:()=>v,S9:()=>m,Vo:()=>i,l0:()=>r,qu:()=>o,u6:()=>S});var _=Math.pow,h=(d,E,u)=>new Promise((C,l)=>{var L=t=>{try{e(u.next(t))}catch(s){l(s)}},N=t=>{try{e(u.throw(t))}catch(s){l(s)}},e=t=>t.done?C(t.value):Promise.resolve(t.value).then(L,N);e((u=u.apply(d,E)).next())});const a=$substore,P={viettel:["Viettel Group","VIETTEL","AS7552 Viettel Group","VIETEL-AS-AP"],vnpt:["Vietnam Posts and Telecommunications Group","VNPT","AS135905 VIETNAM POSTS AND TELECOMMUNICATIONS GROUP","VNPT-AS-VN"],mobifone:["MOBIFONE","Mobifone Corporation","AS131429 MOBIFONE Corporation","MOBIFONE-AS-VN"],fpt:["FPT Telecom Company","AS18403 FPT Telecom Company","FPT-AS-AP"],google:["Google LLC","Google Cloud","AS15169 Google LLC"],mcloud:["MCLOUD","1mcloud Technology Company Limited","S149078 VPSMMO TECHNOLOGY COMPANY LIMITED","VPSMMO-AS-VN"],gnetwork:["GNETWORK","Gnetwork Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],akamai:["Akamai Technologies","Linode","AS63949 Akamai Connected Cloud","AKAMAI-LINODE-AP"],cloviet:["CLOVIET","Cloud Viet ONE Member Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietDigital:["Viet Digital Technology Liability Company","Mailand Technology Trading Services Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietServer:["Vietserver Services Technology Company Limited","T-media Digital Technology Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],digitalOcean:["DigitalOcean, LLC","AS14061 DigitalOcean, LLC","DIGITALOCEAN-ASN"],cloudfly:["Cloudfly Corporation","AS149089 CLOUDFLY CORPORATION","CLOUDFLY-VN"]};function r(d){return!!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(d)}function o(d){return!!/^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)(\/([1-9]|[1-2][0-9]|3[0-2])){0,1}$/.test(d)}function i(d,E){const u=d.split("."),C=E.split(".");if(u.length<3||C.length<3)return!1;for(let l=0;l<3;l++)if(u[l]!==C[l])return!1;return!0}function v(d){const E=d.split(".");return E[E.length-1]}function I(d){return h(this,null,function*(){const E=`https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(d)}&type=A`,u={Accept:"application/dns-json"};try{const C=yield a.http.get({url:E,headers:u}),l=JSON.parse(C.body);if(l.Status!==0)throw new Error(`HTTP error! status: ${l.Status}`);return l.Answer?l.Answer.map(L=>`${L.data}`)[0]:""}catch(C){return""}})}function m(d){return h(this,null,function*(){return yield a.http.get(`https://dns.google/resolve?name=${d}`).then(u=>{const C=JSON.parse(u.body);if(C.Status===0){const l=C.Answer.find(L=>L.type===1);return l?l.data:""}return""})})}function A(d){return h(this,null,function*(){return yield a.http.get(`http://ip-api.com/json/${d}?fields=country`).then(u=>JSON.parse(u.body).country||"")})}function S(d){return h(this,null,function*(){return yield a.http.get(`http://ip-api.com/json/${d}?fields=isp`).then(u=>JSON.parse(u.body).isp||"")})}function O(d){return h(this,null,function*(){return yield a.http.post({url:"http://ip-api.com/batch?fields=isp",body:JSON.stringify(d)}).then(u=>JSON.parse(u.body).map(l=>l.isp))})}function T(d,E){let u,C;const l=M(d);if((u=E.match(/^(.*?)\/(\d{1,2})$/))&&(C=M(u[1]))>=0){const L=_(2,32-parseInt(u[2]));return l>=C&&l<=C+L-1}return!1}function M(d){let E;if(E=d.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let u=0,C=1;for(let l=4;l>=1;l-=1)u+=C*parseInt(E[l]),C*=256;return u}return-1}},9085:(f,c,n)=>{n.d(c,{G:()=>_});function _(a){return a&&a!=="null"&&a!=="undefined"}function h(a,P){return a.reduce((r,o)=>{const i=o[P];return r[i]||(r[i]=[]),r[i].push(o),r},{})}},4173:(f,c,n)=>{n.d(c,{Ck:()=>T,Hd:()=>d,We:()=>S,eD:()=>M,um:()=>E,xG:()=>O});var _=n(9085),h=n(1058),a=n(1500),P=n(8475),r=Math.pow,o=(e,t,s)=>new Promise((p,y)=>{var D=w=>{try{b(s.next(w))}catch(V){y(V)}},G=w=>{try{b(s.throw(w))}catch(V){y(V)}},b=w=>w.done?p(w.value):Promise.resolve(w.value).then(D,G);b((s=s.apply(e,t)).next())});const i="#sub-store-cached-dns",v="#sub-store-cached-isp",I=7*24*60*60*1e3,m=new P.A(i,I),A=new P.A(v,I);function S(e,t){e.type==="vmess"&&e.network==="ws"&&(e["ws-opts"]=e["ws-opts"]||{},e["ws-opts"].headers=e["ws-opts"].headers||{},e["ws-opts"].headers.Host=t),e.sni=t,(0,_.G)(e["skip-cert-verify"])||(e["skip-cert-verify"]=!0)}const O=(e,t)=>(0,h.A)(e.regex).test(t.name),T=(e,t)=>e.ports.some(s=>s===t.port),M=(e,t)=>o(void 0,null,function*(){return(yield Promise.all(e.ips.map(p=>l(t.server,p)))).some(p=>p)}),d=(e,t)=>o(void 0,null,function*(){return(yield Promise.all(e.isps.map(p=>u(t.server,p)))).some(p=>p)});function E(e,t,s){return o(this,null,function*(){return(yield Promise.all(e.map(y=>y(t,s)))).every(y=>y)})}function u(e,t){return o(this,null,function*(){let s=e;if((0,a.l0)(e)){const p=m.get(e);if(p)s=p;else{const y=yield(0,a.S9)(e);s=y,y&&m.set(e,y)}}return C(s,t)})}function C(e,t){return o(this,null,function*(){let s="";const p=A.get(e);return p?s=p:(s=yield(0,a.u6)(e),s&&A.set(e,s)),!!a.Dq[t].some(D=>RegExp(`${D}`,"i").test(s))})}function l(e,t){return o(this,null,function*(){let s=e;if((0,a.l0)(e)){const p=m.get(e);if(p)s=p;else{const y=yield(0,a.S9)(e);s=y,y&&m.set(e,y)}}return L(s,t)})}function L(e,t){if(!(0,a.qu)(e))return!1;if(t.indexOf("/")<0)return!!(e===t||(0,a.Vo)(e,t)&&(0,a.Mi)(t)==="*");let s,p;const y=N(e);if((s=t.match(/^(.*?)\/(\d{1,2})$/))&&(p=N(s[1]))>=0){const D=r(2,32-parseInt(s[2]));return y>=p&&y<=p+D-1}return!1}function N(e){let t;if(t=e.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let s=0,p=1;for(let y=4;y>=1;y-=1)s+=p*parseInt(t[y]),p*=256;return s}return-1}},1058:(f,c,n)=>{n.d(c,{A:()=>_});function _(h){const a=h.lastIndexOf("/");return new RegExp(h.slice(1,a),h.slice(a+1))}}},R={};function g(f){var c=R[f];if(c!==void 0)return c.exports;var n=R[f]={exports:{}};return k[f](n,n.exports,g),n.exports}g.n=f=>{var c=f&&f.__esModule?()=>f.default:()=>f;return g.d(c,{a:c}),c},g.d=(f,c)=>{for(var n in c)g.o(c,n)&&!g.o(f,n)&&Object.defineProperty(f,n,{enumerable:!0,get:c[n]})},g.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(f){if(typeof window=="object")return window}}(),g.o=(f,c)=>Object.prototype.hasOwnProperty.call(f,c);var x={};(()=>{var f=g(3183),c=g.n(f),n=g(9085),_=g(423),h=g(4173),a=(r,o,i)=>new Promise((v,I)=>{var m=O=>{try{S(i.next(O))}catch(T){I(T)}},A=O=>{try{S(i.throw(O))}catch(T){I(T)}},S=O=>O.done?v(O.value):Promise.resolve(O.value).then(m,A);S((i=i.apply(r,o)).next())});function P(r){return a(this,null,function*(){const o=yield(0,_.ru)();for(const i of r){let v="";for(const I in o){const m=o[I];if((0,n.G)(m)){if(I==="default"){v=m.sni;continue}if((0,n.G)(m.sni)&&(!(0,n.G)(m.skip)||!m.skip)){const A=[];if((0,n.G)(m.regex)&&A.push(h.xG),(0,n.G)(m.ports)&&A.push(h.Ck),(0,n.G)(m.ips)&&A.push(h.eD),(0,n.G)(m.isps)&&A.push(h.Hd),(yield(0,h.um)(A,m,i))||A.length===0){v=m.sni;break}}}}(0,h.We)(i,v)}return r})}c().operator=P})()})();})();
