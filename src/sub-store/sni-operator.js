(()=>{(()=>{"use strict";var R={183:(u,l,f)=>{var _;typeof window!="undefined"?_=window:typeof f.g!="undefined"?_=f.g:typeof self!="undefined"?_=self:_={},u.exports=_}},I={};function y(u){var l=I[u];if(l!==void 0)return l.exports;var f=I[u]={exports:{}};return R[u](f,f.exports,y),f.exports}y.n=u=>{var l=u&&u.__esModule?()=>u.default:()=>u;return y.d(l,{a:l}),l},y.d=(u,l)=>{for(var f in l)y.o(l,f)&&!y.o(u,f)&&Object.defineProperty(u,f,{enumerable:!0,get:l[f]})},y.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(u){if(typeof window=="object")return window}}(),y.o=(u,l)=>Object.prototype.hasOwnProperty.call(u,l);var X={};(()=>{var u=y(183),l=y.n(u);const f=$substore;class _{constructor(s,t){this.key=s,this.expires=t;const n=f.read(s);n?this.resourceCache=JSON.parse(n):(this.resourceCache={},this._persist()),this._cleanup()}_cleanup(){let s=!1;const t=new Date().getTime();Object.keys(this.resourceCache).forEach(n=>{const r=this.resourceCache[n];(!r.time||t-r.time>this.expires)&&(delete this.resourceCache[n],f.delete(`#${n}`),s=!0)}),s&&this._persist()}revokeIds(s){let t=!1;for(const n of s)delete this.resourceCache[n],t=!0;t&&this._persist()}revokeAll(){this.resourceCache={},this._persist()}_persist(){f.write(JSON.stringify(this.resourceCache),this.key)}get(s){const t=this.resourceCache[s]&&this.resourceCache[s].time;return t&&new Date().getTime()-t<=this.expires?this.resourceCache[s].data:null}set(s,t){this.resourceCache[s]={time:new Date().getTime(),data:t},this._persist()}}const b=_;function d(e){return e&&e!=="null"&&e!=="undefined"}function $(e){const s=e.lastIndexOf("/");return new RegExp(e.slice(1,s),e.slice(s+1))}var M=Math.pow,g=(e,s,t)=>new Promise((n,r)=>{var a=i=>{try{p(t.next(i))}catch(o){r(o)}},m=i=>{try{p(t.throw(i))}catch(o){r(o)}},p=i=>i.done?n(i.value):Promise.resolve(i.value).then(a,m);p((t=t.apply(e,s)).next())});const C=$substore,F={viettel:["Viettel Group","VIETTEL","AS7552 Viettel Group","VIETEL-AS-AP"],vnpt:["Vietnam Posts and Telecommunications Group","VNPT","AS135905 VIETNAM POSTS AND TELECOMMUNICATIONS GROUP","VNPT-AS-VN"],mobifone:["MOBIFONE","Mobifone Corporation","AS131429 MOBIFONE Corporation","MOBIFONE-AS-VN"],fpt:["FPT Telecom Company","AS18403 FPT Telecom Company","FPT-AS-AP"]};function O(e){return!!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(e)}function V(e){return!!/^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)(\/([1-9]|[1-2][0-9]|3[0-2])){0,1}$/.test(e)}function D(e,s){const t=e.split("."),n=s.split(".");if(t.length<3||n.length<3)return!1;for(let r=0;r<3;r++)if(t[r]!==n[r])return!1;return!0}function L(e){const s=e.split(".");return s[s.length-1]}function E(e){return g(this,null,function*(){return yield C.http.get(`https://dns.google/resolve?name=${e}`).then(t=>{const n=JSON.parse(t.body);if(n.Status===0){const r=n.Answer.find(a=>a.type===1);return r?r.data:""}return""})})}function Q(e){return g(this,null,function*(){return yield C.http.get(`http://ip-api.com/json/${e}?fields=country`).then(t=>JSON.parse(t.body).country||"")})}function J(e){return g(this,null,function*(){return yield C.http.get(`http://ip-api.com/json/${e}?fields=isp`).then(t=>JSON.parse(t.body).isp||"")})}function W(e){return g(this,null,function*(){return yield C.http.post({url:"http://ip-api.com/batch?fields=isp",body:JSON.stringify(e)}).then(t=>JSON.parse(t.body).map(r=>r.isp))})}function Z(e,s){let t,n;const r=P(e);if((t=s.match(/^(.*?)\/(\d{1,2})$/))&&(n=P(t[1]))>=0){const a=M(2,32-parseInt(t[2]));return r>=n&&r<=n+a-1}return!1}function P(e){let s;if(s=e.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let t=0,n=1;for(let r=4;r>=1;r-=1)t+=n*parseInt(s[r]),n*=256;return t}return-1}var N=(e,s,t)=>new Promise((n,r)=>{var a=i=>{try{p(t.next(i))}catch(o){r(o)}},m=i=>{try{p(t.throw(i))}catch(o){r(o)}},p=i=>i.done?n(i.value):Promise.resolve(i.value).then(a,m);p((t=t.apply(e,s)).next())});function U(){return N(this,null,function*(){const e=yield produceArtifact({type:"file",name:"proxy_config"});return ProxyUtils.yaml.safeLoad(e)})}function ee(){return N(this,null,function*(){const e=yield produceArtifact({type:"file",name:"subscription_config"});return ProxyUtils.yaml.safeLoad(e)})}function T(e,s){e.type==="vmess"&&e.network==="ws"&&(e["ws-opts"]=e["ws-opts"]||{},e["ws-opts"].headers=e["ws-opts"].headers||{},e["ws-opts"].headers.Host=s),e.sni=s,d(e["skip-cert-verify"])||(e["skip-cert-verify"]=!0)}var j=Math.pow,v=(e,s,t)=>new Promise((n,r)=>{var a=i=>{try{p(t.next(i))}catch(o){r(o)}},m=i=>{try{p(t.throw(i))}catch(o){r(o)}},p=i=>i.done?n(i.value):Promise.resolve(i.value).then(a,m);p((t=t.apply(e,s)).next())});const G="#sub-store-cached-dns",H="#sub-store-cached-isp",A=7*24*60*60*1e3,S=new b(G,A),k=new b(H,A);function z(e){return v(this,null,function*(){const{ignoreRule:s,type:t}=$arguments,n=yield U(),r=(i,o)=>$(i.regex).test(o.name),a=(i,o)=>i.ports.some(h=>h===o.port),m=(i,o)=>v(this,null,function*(){return(yield Promise.all(i.ips.map(c=>Y(o.server,c)))).some(c=>c)}),p=(i,o)=>v(this,null,function*(){return(yield Promise.all(i.isps.map(c=>B(o.server,c)))).some(c=>c)});if(d(t))for(const i of e){const o=n[t];if(!d(o))break;const h=[];d(o.regex)&&h.push(r),d(o.ports)&&h.push(a),d(o.ips)&&h.push(m),d(o.isps)&&h.push(p),((yield x(h,o,i))||h.length===0)&&T(i,o.sni)}else for(const i of e){let o="";for(const h in n){const c=n[h];if(d(c)){if(h==="default"){o=c.sni;continue}if((!s||!/true/i.test(s))&&(!d(c.skip)||!c.skip)){const w=[];if(d(c.regex)&&w.push(r),d(c.ports)&&w.push(a),d(c.ips)&&w.push(m),d(c.isps)&&w.push(p),yield x(w,c,i)){o=c.sni;break}}}}T(i,o)}return e})}function x(e,s,t){return v(this,null,function*(){return(yield Promise.all(e.map(r=>r(s,t)))).every(r=>r)})}function B(e,s){return v(this,null,function*(){let t=e;if(O(e)){const n=S.get(e);if(n)t=n;else{const r=yield E(e);t=r,r&&S.set(e,r)}}return K(t,s)})}function K(e,s){return v(this,null,function*(){let t="";const n=k.get(e);return n?t=n:(t=yield J(e),t&&k.set(e,t)),!!F[s].some(a=>RegExp(`${a}`,"i").test(t))})}function Y(e,s){return v(this,null,function*(){let t=e;if(O(e)){const n=S.get(e);if(n)t=n;else{const r=yield E(e);t=r,r&&S.set(e,r)}}return q(t,s)})}function q(e,s){if(!V(e))return!1;if(s.indexOf("/")<0)return!!(e===s||D(e,s)&&L(s)==="*");let t,n;const r=P(e);if((t=s.match(/^(.*?)\/(\d{1,2})$/))&&(n=P(t[1]))>=0){const a=j(2,32-parseInt(t[2]));return r>=n&&r<=n+a-1}return!1}l().operator=z})()})();})();
