/*
 fullhash:6f33446f5136ee72b221, chunkhash:ee698fe3566b9364d5f0, file:sub-store/sni-operator.js
 author: Kien Tran
 */
(()=>{(()=>{"use strict";var U={3183:(_,l,r)=>{var m;typeof window!="undefined"?m=window:typeof r.g!="undefined"?m=r.g:typeof self!="undefined"?m=self:m={},_.exports=m},8475:(_,l,r)=>{r.d(l,{A:()=>i});const m=$substore;class h{constructor(t,o){this.key=t,this.expires=o;const a=m.read(t);a?this.resourceCache=JSON.parse(a):(this.resourceCache={},this._persist()),this._cleanup()}_cleanup(){let t=!1;const o=new Date().getTime();Object.keys(this.resourceCache).forEach(a=>{const O=this.resourceCache[a];(!O.time||o-O.time>this.expires)&&(delete this.resourceCache[a],m.delete(`#${a}`),t=!0)}),t&&this._persist()}revokeIds(t){let o=!1;for(const a of t)delete this.resourceCache[a],o=!0;o&&this._persist()}revokeAll(){this.resourceCache={},this._persist()}_persist(){m.write(JSON.stringify(this.resourceCache),this.key)}get(t){const o=this.resourceCache[t]&&this.resourceCache[t].time;return o&&new Date().getTime()-o<=this.expires?this.resourceCache[t].data:null}set(t,o){this.resourceCache[t]={time:new Date().getTime(),data:o},this._persist()}}const i=h},423:(_,l,r)=>{r.d(l,{ru:()=>h});var m=(t,o,a)=>new Promise((O,A)=>{var C=E=>{try{P(a.next(E))}catch(T){A(T)}},v=E=>{try{P(a.throw(E))}catch(T){A(T)}},P=E=>E.done?O(E.value):Promise.resolve(E.value).then(C,v);P((a=a.apply(t,o)).next())});function h(){return m(this,null,function*(){const t=yield produceArtifact({type:"file",name:"proxy_config"});return ProxyUtils.yaml.safeLoad(t)})}function i(){return m(this,null,function*(){const t=yield produceArtifact({type:"file",name:"subscription_config"});return ProxyUtils.yaml.safeLoad(t)})}function I(t){return m(this,null,function*(){const o=normalizeString(t),a=yield i();let O="";for(const A in a)if(containsIgnoreCase(o,normalizeString(A))){O=A;break}return a[O]})}},1500:(_,l,r)=>{r.d(l,{Dq:()=>I,Mi:()=>O,S9:()=>C,Vo:()=>a,l0:()=>t,qu:()=>o,sY:()=>P,u6:()=>E});var m=Math.pow,h=(p,y,c)=>new Promise((d,f)=>{var L=w=>{try{D(c.next(w))}catch(e){f(e)}},G=w=>{try{D(c.throw(w))}catch(e){f(e)}},D=w=>w.done?d(w.value):Promise.resolve(w.value).then(L,G);D((c=c.apply(p,y)).next())});const i=$substore,I={viettel:["Viettel Group","VIETTEL","AS7552 Viettel Group","VIETEL-AS-AP"],vnpt:["Vietnam Posts and Telecommunications Group","VNPT","AS135905 VIETNAM POSTS AND TELECOMMUNICATIONS GROUP","VNPT-AS-VN"],mobifone:["MOBIFONE","Mobifone Corporation","AS131429 MOBIFONE Corporation","MOBIFONE-AS-VN"],fpt:["FPT Telecom Company","AS18403 FPT Telecom Company","FPT-AS-AP"],google:["Google LLC","Google Cloud","AS15169 Google LLC"],mcloud:["MCLOUD","1mcloud Technology Company Limited","S149078 VPSMMO TECHNOLOGY COMPANY LIMITED","VPSMMO-AS-VN"],gnetwork:["GNETWORK","Gnetwork Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],akamai:["Akamai Technologies","Linode","AS63949 Akamai Connected Cloud","AKAMAI-LINODE-AP"],cloviet:["CLOVIET","Cloud Viet ONE Member Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietDigital:["Viet Digital Technology Liability Company","Mailand Technology Trading Services Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietServer:["Vietserver Services Technology Company Limited","T-media Digital Technology Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],digitalOcean:["DigitalOcean, LLC","AS14061 DigitalOcean, LLC","DIGITALOCEAN-ASN"],cloudfly:["Cloudfly Corporation","AS149089 CLOUDFLY CORPORATION","CLOUDFLY-VN"]};function t(p){return!!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(p)}function o(p){return!!/^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)(\/([1-9]|[1-2][0-9]|3[0-2])){0,1}$/.test(p)}function a(p,y){const c=p.split("."),d=y.split(".");if(c.length<3||d.length<3)return!1;for(let f=0;f<3;f++)if(c[f]!==d[f])return!1;return!0}function O(p){const y=p.split(".");return y[y.length-1]}function A(p){return h(this,null,function*(){const y=`https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(p)}&type=A`,c={Accept:"application/dns-json"};try{const d=yield i.http.get({url:y,headers:c}),f=JSON.parse(d.body);if(f.Status!==0)throw new Error(`HTTP error! status: ${f.Status}`);return f.Answer?f.Answer.map(L=>`${L.data}`)[0]:""}catch(d){return""}})}function C(p){return h(this,null,function*(){return yield i.http.get(`https://dns.google/resolve?name=${p}`).then(c=>{const d=JSON.parse(c.body);if(d.Status===0){const f=d.Answer.find(L=>L.type===1);return f?f.data:""}return""})})}function v(p){return h(this,null,function*(){return yield i.http.get(`http://ip-api.com/json/${p}?fields=country`).then(c=>JSON.parse(c.body).country||"")})}function P(p){return h(this,null,function*(){return yield i.http.get(`http://ip-api.com/json/${p}?fields=region,regionName`).then(c=>{const d=JSON.parse(c.body);return d.regionName&&d.region?`${d.regionName} (${d.region})`:""})})}function E(p){return h(this,null,function*(){return yield i.http.get(`http://ip-api.com/json/${p}?fields=isp`).then(c=>JSON.parse(c.body).isp||"")})}function T(p){return h(this,null,function*(){return yield i.http.post({url:"http://ip-api.com/batch?fields=isp",body:JSON.stringify(p)}).then(c=>JSON.parse(c.body).map(f=>f.isp))})}function x(p,y){let c,d;const f=V(p);if((c=y.match(/^(.*?)\/(\d{1,2})$/))&&(d=V(c[1]))>=0){const L=m(2,32-parseInt(c[2]));return f>=d&&f<=d+L-1}return!1}function V(p){let y;if(y=p.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let c=0,d=1;for(let f=4;f>=1;f-=1)c+=d*parseInt(y[f]),d*=256;return c}return-1}},9085:(_,l,r)=>{r.d(l,{G:()=>m});function m(i){return i&&i!=="null"&&i!=="undefined"}function h(i,I){return i.reduce((t,o)=>{const a=o[I];return t[a]||(t[a]=[]),t[a].push(o),t},{})}},4173:(_,l,r)=>{r.d(l,{$S:()=>c,Ck:()=>V,Hd:()=>y,We:()=>T,eD:()=>p,um:()=>d,xG:()=>x});var m=r(9085),h=r(1058),i=r(1500),I=r(8475),t=Math.pow,o=(e,s,u)=>new Promise((n,g)=>{var N=R=>{try{b(u.next(R))}catch($){g($)}},M=R=>{try{b(u.throw(R))}catch($){g($)}},b=R=>R.done?n(R.value):Promise.resolve(R.value).then(N,M);b((u=u.apply(e,s)).next())});const a="#sub-store-cached-dns",O="#sub-store-cached-isp",A="#sub-store-cached-region",C=7*24*60*60*1e3,v=new I.A(a,C),P=new I.A(O,C),E=new I.A(A,C);function T(e,s){e.type==="vmess"&&e.network==="ws"&&(e["ws-opts"]=e["ws-opts"]||{},e["ws-opts"].headers=e["ws-opts"].headers||{},e["ws-opts"].headers.Host=s),e.sni=s,(0,m.G)(e["skip-cert-verify"])||(e["skip-cert-verify"]=!0)}function x(e,s){return(0,h.r)(e.regex).test(s.name)}function V(e,s){return e.ports.some(u=>u===s.port)}function p(e,s){return o(this,null,function*(){return(yield Promise.all(e.ips.map(n=>G(s.server,n)))).some(n=>n)})}function y(e,s){return o(this,null,function*(){return(yield Promise.all(e.isps.map(n=>L(s.server,n)))).some(n=>n)})}function c(e,s){return o(this,null,function*(){return(yield Promise.all(e.regions.map(n=>f(s.server,n)))).some(n=>n)})}function d(e,s,u){return o(this,null,function*(){return(yield Promise.all(e.map(g=>g(s,u)))).every(g=>g)})}function f(e,s){return o(this,null,function*(){const u=yield D(e);try{let n="";const g=E.get(u);g?n=g:(n=yield(0,i.sY)(u),n&&E.set(u,n));const N=(0,h.Z)(n);if(N){const{name:M,code:b}=N;if(s.toLowerCase()===M.toLowerCase()||s.toLowerCase()===b.toLowerCase())return!0}}catch(n){return!1}return!1})}function L(e,s){return o(this,null,function*(){const u=yield D(e);let n="";const g=P.get(u);return g?n=g:(n=yield(0,i.u6)(u),n&&P.set(u,n)),!!i.Dq[s].some(M=>RegExp(`${M}`,"i").test(n))})}function G(e,s){return o(this,null,function*(){const u=yield D(e);if(!(0,i.qu)(u))return!1;if(s.indexOf("/")<0)return!!(u===s||(0,i.Vo)(u,s)&&(0,i.Mi)(s)==="*");let n,g;const N=w(u);if((n=s.match(/^(.*?)\/(\d{1,2})$/))&&(g=w(n[1]))>=0){const M=t(2,32-parseInt(n[2]));return N>=g&&N<=g+M-1}return!1})}function D(e){return o(this,null,function*(){let s=e;if((0,i.l0)(e)){const u=v.get(e);if(u)s=u;else{const n=yield(0,i.S9)(e);s=n,n&&v.set(e,n)}}return s})}function w(e){let s;if(s=e.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let u=0,n=1;for(let g=4;g>=1;g-=1)u+=n*parseInt(s[g]),n*=256;return u}return-1}},1058:(_,l,r)=>{r.d(l,{Z:()=>h,r:()=>m});function m(i){const I=i.lastIndexOf("/");return new RegExp(i.slice(1,I),i.slice(I+1))}function h(i){const I=/^([^\(]+) \(([^)]+)\)$/,t=i.match(I);return t?{name:t[1].trim(),code:t[2]}:null}}},k={};function S(_){var l=k[_];if(l!==void 0)return l.exports;var r=k[_]={exports:{}};return U[_](r,r.exports,S),r.exports}S.n=_=>{var l=_&&_.__esModule?()=>_.default:()=>_;return S.d(l,{a:l}),l},S.d=(_,l)=>{for(var r in l)S.o(l,r)&&!S.o(_,r)&&Object.defineProperty(_,r,{enumerable:!0,get:l[r]})},S.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(_){if(typeof window=="object")return window}}(),S.o=(_,l)=>Object.prototype.hasOwnProperty.call(_,l);var Y={};(()=>{var _=S(3183),l=S.n(_),r=S(9085),m=S(423),h=S(4173),i=(t,o,a)=>new Promise((O,A)=>{var C=E=>{try{P(a.next(E))}catch(T){A(T)}},v=E=>{try{P(a.throw(E))}catch(T){A(T)}},P=E=>E.done?O(E.value):Promise.resolve(E.value).then(C,v);P((a=a.apply(t,o)).next())});function I(t){return i(this,null,function*(){const o=yield(0,m.ru)();for(const a of t){let O="";for(const A in o){const C=o[A];if((0,r.G)(C)){if(A==="default"){O=C.sni;continue}if((0,r.G)(C.sni)&&(!(0,r.G)(C.skip)||!C.skip)){const v=[];if((0,r.G)(C.regex)&&v.push(h.xG),(0,r.G)(C.ports)&&v.push(h.Ck),(0,r.G)(C.ips)&&v.push(h.eD),(0,r.G)(C.isps)&&v.push(h.Hd),(0,r.G)(C.regions)&&v.push(h.$S),(yield(0,h.um)(v,C,a))||v.length===0){O=C.sni;break}}}}(0,h.We)(a,O)}return t})}l().operator=I})()})();})();
