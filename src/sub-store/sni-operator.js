(()=>{(()=>{"use strict";var M={183:(c,l,f)=>{var C;typeof window!="undefined"?C=window:typeof f.g!="undefined"?C=f.g:typeof self!="undefined"?C=self:C={},c.exports=C}},_={};function m(c){var l=_[c];if(l!==void 0)return l.exports;var f=_[c]={exports:{}};return M[c](f,f.exports,m),f.exports}m.n=c=>{var l=c&&c.__esModule?()=>c.default:()=>c;return m.d(l,{a:l}),l},m.d=(c,l)=>{for(var f in l)m.o(l,f)&&!m.o(c,f)&&Object.defineProperty(c,f,{enumerable:!0,get:l[f]})},m.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(c){if(typeof window=="object")return window}}(),m.o=(c,l)=>Object.prototype.hasOwnProperty.call(c,l);var W={};(()=>{var c=m(183),l=m.n(c);const f=$substore;class C{constructor(n,t){this.key=n,this.expires=t;const s=f.read(n);s?this.resourceCache=JSON.parse(s):(this.resourceCache={},this._persist()),this._cleanup()}_cleanup(){let n=!1;const t=new Date().getTime();Object.keys(this.resourceCache).forEach(s=>{const r=this.resourceCache[s];(!r.time||t-r.time>this.expires)&&(delete this.resourceCache[s],f.delete(`#${s}`),n=!0)}),n&&this._persist()}revokeIds(n){let t=!1;for(const s of n)delete this.resourceCache[s],t=!0;t&&this._persist()}revokeAll(){this.resourceCache={},this._persist()}_persist(){f.write(JSON.stringify(this.resourceCache),this.key)}get(n){const t=this.resourceCache[n]&&this.resourceCache[n].time;return t&&new Date().getTime()-t<=this.expires?this.resourceCache[n].data:null}set(n,t){this.resourceCache[n]={time:new Date().getTime(),data:t},this._persist()}}const A=C;function d(e){return e&&e!=="null"&&e!=="undefined"}function R(e){const n=e.lastIndexOf("/");return new RegExp(e.slice(1,n),e.slice(n+1))}var D=Math.pow,I=(e,n,t)=>new Promise((s,r)=>{var u=i=>{try{p(t.next(i))}catch(o){r(o)}},y=i=>{try{p(t.throw(i))}catch(o){r(o)}},p=i=>i.done?s(i.value):Promise.resolve(i.value).then(u,y);p((t=t.apply(e,n)).next())});const v=$substore,k={viettel:["Viettel Group","VIETTEL","AS7552 Viettel Group","VIETEL-AS-AP"],vnpt:["Vietnam Posts and Telecommunications Group","VNPT","AS135905 VIETNAM POSTS AND TELECOMMUNICATIONS GROUP","VNPT-AS-VN"],mobifone:["MOBIFONE","Mobifone Corporation","AS131429 MOBIFONE Corporation","MOBIFONE-AS-VN"],fpt:["FPT Telecom Company","AS18403 FPT Telecom Company","FPT-AS-AP"],google:["Google LLC","Google Cloud","AS15169 Google LLC"],mcloud:["MCLOUD","1mcloud Technology Company Limited","S149078 VPSMMO TECHNOLOGY COMPANY LIMITED","VPSMMO-AS-VN"],gnetwork:["GNETWORK","Gnetwork Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],akamai:["Akamai Technologies","Linode","AS63949 Akamai Connected Cloud","AKAMAI-LINODE-AP"],cloviet:["CLOVIET","Cloud Viet ONE Member Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietDigital:["Viet Digital Technology Liability Company","Mailand Technology Trading Services Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietServer:["Vietserver Services Technology Company Limited","T-media Digital Technology Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],digitalOcean:["DigitalOcean, LLC","AS14061 DigitalOcean, LLC","DIGITALOCEAN-ASN"],cloudfly:["Cloudfly Corporation","AS149089 CLOUDFLY CORPORATION","CLOUDFLY-VN"]};function T(e){return!!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(e)}function x(e){return!!/^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)(\/([1-9]|[1-2][0-9]|3[0-2])){0,1}$/.test(e)}function G(e,n){const t=e.split("."),s=n.split(".");if(t.length<3||s.length<3)return!1;for(let r=0;r<3;r++)if(t[r]!==s[r])return!1;return!0}function Y(e){const n=e.split(".");return n[n.length-1]}function w(e){return I(this,null,function*(){return yield v.http.get(`https://dns.google/resolve?name=${e}`).then(t=>{const s=JSON.parse(t.body);if(s.Status===0){const r=s.Answer.find(u=>u.type===1);return r?r.data:""}return""})})}function X(e){return I(this,null,function*(){return yield v.http.get(`http://ip-api.com/json/${e}?fields=country`).then(t=>JSON.parse(t.body).country||"")})}function $(e){return I(this,null,function*(){return yield v.http.get(`http://ip-api.com/json/${e}?fields=isp`).then(t=>JSON.parse(t.body).isp||"")})}function Q(e){return I(this,null,function*(){return yield v.http.post({url:"http://ip-api.com/batch?fields=isp",body:JSON.stringify(e)}).then(t=>JSON.parse(t.body).map(r=>r.isp))})}function Z(e,n){let t,s;const r=O(e);if((t=n.match(/^(.*?)\/(\d{1,2})$/))&&(s=O(t[1]))>=0){const u=D(2,32-parseInt(t[2]));return r>=s&&r<=s+u-1}return!1}function O(e){let n;if(n=e.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let t=0,s=1;for(let r=4;r>=1;r-=1)t+=s*parseInt(n[r]),s*=256;return t}return-1}var L=(e,n,t)=>new Promise((s,r)=>{var u=i=>{try{p(t.next(i))}catch(o){r(o)}},y=i=>{try{p(t.throw(i))}catch(o){r(o)}},p=i=>i.done?s(i.value):Promise.resolve(i.value).then(u,y);p((t=t.apply(e,n)).next())});function F(){return L(this,null,function*(){const e=yield produceArtifact({type:"file",name:"proxy_config"});return ProxyUtils.yaml.safeLoad(e)})}function ee(){return L(this,null,function*(){const e=yield produceArtifact({type:"file",name:"subscription_config"});return ProxyUtils.yaml.safeLoad(e)})}function N(e,n){e.type==="vmess"&&e.network==="ws"&&(e["ws-opts"]=e["ws-opts"]||{},e["ws-opts"].headers=e["ws-opts"].headers||{},e["ws-opts"].headers.Host=n),e.sni=n,d(e["skip-cert-verify"])||(e["skip-cert-verify"]=!0)}var H=Math.pow,g=(e,n,t)=>new Promise((s,r)=>{var u=i=>{try{p(t.next(i))}catch(o){r(o)}},y=i=>{try{p(t.throw(i))}catch(o){r(o)}},p=i=>i.done?s(i.value):Promise.resolve(i.value).then(u,y);p((t=t.apply(e,n)).next())});const U="#sub-store-cached-dns",J="#sub-store-cached-isp",P=7*24*60*60*1e3,E=new A(U,P),V=new A(J,P);function j(e){return g(this,null,function*(){const{ignoreRule:n,type:t}=$arguments,s=yield F(),r=(i,o)=>R(i.regex).test(o.name),u=(i,o)=>i.ports.some(h=>h===o.port),y=(i,o)=>g(this,null,function*(){return(yield Promise.all(i.ips.map(a=>z(o.server,a)))).some(a=>a)}),p=(i,o)=>g(this,null,function*(){return(yield Promise.all(i.isps.map(a=>B(o.server,a)))).some(a=>a)});if(d(t))for(const i of e){const o=s[t];if(!d(o))break;const h=[];d(o.regex)&&h.push(r),d(o.ports)&&h.push(u),d(o.ips)&&h.push(y),d(o.isps)&&h.push(p),((yield b(h,o,i))||h.length===0)&&N(i,o.sni)}else for(const i of e){let o="";for(const h in s){const a=s[h];if(d(a)){if(h==="default"){o=a.sni;continue}if((!n||!/true/i.test(n))&&(!d(a.skip)||!a.skip)){const S=[];if(d(a.regex)&&S.push(r),d(a.ports)&&S.push(u),d(a.ips)&&S.push(y),d(a.isps)&&S.push(p),yield b(S,a,i)){o=a.sni;break}}}}N(i,o)}return e})}function b(e,n,t){return g(this,null,function*(){return(yield Promise.all(e.map(r=>r(n,t)))).every(r=>r)})}function B(e,n){return g(this,null,function*(){let t=e;if(T(e)){const s=E.get(e);if(s)t=s;else{const r=yield w(e);t=r,r&&E.set(e,r)}}return K(t,n)})}function K(e,n){return g(this,null,function*(){let t="";const s=V.get(e);return s?t=s:(t=yield $(e),t&&V.set(e,t)),!!k[n].some(u=>RegExp(`${u}`,"i").test(t))})}function z(e,n){return g(this,null,function*(){let t=e;if(T(e)){const s=E.get(e);if(s)t=s;else{const r=yield w(e);t=r,r&&E.set(e,r)}}return q(t,n)})}function q(e,n){if(!x(e))return!1;if(n.indexOf("/")<0)return!!(e===n||G(e,n)&&Y(n)==="*");let t,s;const r=O(e);if((t=n.match(/^(.*?)\/(\d{1,2})$/))&&(s=O(t[1]))>=0){const u=H(2,32-parseInt(t[2]));return r>=s&&r<=s+u-1}return!1}l().operator=j})()})();})();
