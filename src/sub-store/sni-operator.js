/*
 fullhash:3fc6beca47d10e8cd03d, chunkhash:e44b612c9a3782ab1a34, file:sub-store/sni-operator.js
 author: Kien Tran
 */
(()=>{(()=>{"use strict";var k={3183:(d,c,l)=>{var i;typeof window!="undefined"?i=window:typeof l.g!="undefined"?i=l.g:typeof self!="undefined"?i=self:i={},d.exports=i},8475:(d,c,l)=>{l.d(c,{A:()=>r});const i=$substore;class _{constructor(s,p){this.key=s,this.expires=p;const o=i.read(s);o?this.resourceCache=JSON.parse(o):(this.resourceCache={},this._persist()),this._cleanup()}_cleanup(){let s=!1;const p=new Date().getTime();Object.keys(this.resourceCache).forEach(o=>{const v=this.resourceCache[o];(!v.time||p-v.time>this.expires)&&(delete this.resourceCache[o],i.delete(`#${o}`),s=!0)}),s&&this._persist()}revokeIds(s){let p=!1;for(const o of s)delete this.resourceCache[o],p=!0;p&&this._persist()}revokeAll(){this.resourceCache={},this._persist()}_persist(){i.write(JSON.stringify(this.resourceCache),this.key)}get(s){const p=this.resourceCache[s]&&this.resourceCache[s].time;return p&&new Date().getTime()-p<=this.expires?this.resourceCache[s].data:null}set(s,p){this.resourceCache[s]={time:new Date().getTime(),data:p},this._persist()}}const r=_},423:(d,c,l)=>{l.d(c,{ru:()=>_});var i=(s,p,o)=>new Promise((v,w)=>{var L=E=>{try{T(o.next(E))}catch(P){w(P)}},N=E=>{try{T(o.throw(E))}catch(P){w(P)}},T=E=>E.done?v(E.value):Promise.resolve(E.value).then(L,N);T((o=o.apply(s,p)).next())});function _(){return i(this,null,function*(){const s=yield produceArtifact({type:"file",name:"proxy_config"});return ProxyUtils.yaml.safeLoad(s)})}function r(){return i(this,null,function*(){const s=yield produceArtifact({type:"file",name:"subscription_config"});return ProxyUtils.yaml.safeLoad(s)})}function O(s){return i(this,null,function*(){const p=normalizeString(s),o=yield r();let v="";for(const w in o)if(containsIgnoreCase(p,normalizeString(w))){v=w;break}return o[v]})}},1500:(d,c,l)=>{l.d(c,{Dq:()=>O,GQ:()=>V,Mi:()=>v,S9:()=>L,Vo:()=>o,l0:()=>s,qu:()=>p,u6:()=>T});var i=Math.pow,_=(u,m,a)=>new Promise((e,t)=>{var n=C=>{try{f(a.next(C))}catch(g){t(g)}},y=C=>{try{f(a.throw(C))}catch(g){t(g)}},f=C=>C.done?e(C.value):Promise.resolve(C.value).then(n,y);f((a=a.apply(u,m)).next())});const r=$substore,O={viettel:["Viettel Group","VIETTEL","AS7552 Viettel Group","VIETEL-AS-AP"],vnpt:["Vietnam Posts and Telecommunications Group","VNPT","AS135905 VIETNAM POSTS AND TELECOMMUNICATIONS GROUP","VNPT-AS-VN"],mobifone:["MOBIFONE","Mobifone Corporation","AS131429 MOBIFONE Corporation","MOBIFONE-AS-VN"],fpt:["FPT Telecom Company","AS18403 FPT Telecom Company","FPT-AS-AP"],google:["Google LLC","Google Cloud","AS15169 Google LLC"],mcloud:["MCLOUD","1mcloud Technology Company Limited","S149078 VPSMMO TECHNOLOGY COMPANY LIMITED","VPSMMO-AS-VN"],gnetwork:["GNETWORK","Gnetwork Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],akamai:["Akamai Technologies","Linode","AS63949 Akamai Connected Cloud","AKAMAI-LINODE-AP"],cloviet:["CLOVIET","Cloud Viet ONE Member Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietDigital:["Viet Digital Technology Liability Company","Mailand Technology Trading Services Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietServer:["Vietserver Services Technology Company Limited","T-media Digital Technology Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],digitalOcean:["DigitalOcean, LLC","AS14061 DigitalOcean, LLC","DIGITALOCEAN-ASN"],cloudfly:["Cloudfly Corporation","AS149089 CLOUDFLY CORPORATION","CLOUDFLY-VN"]};function s(u){return!!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(u)}function p(u){return!!/^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)(\/([1-9]|[1-2][0-9]|3[0-2])){0,1}$/.test(u)}function o(u,m){const a=u.split("."),e=m.split(".");if(a.length<3||e.length<3)return!1;for(let t=0;t<3;t++)if(a[t]!==e[t])return!1;return!0}function v(u){const m=u.split(".");return m[m.length-1]}function w(u){return _(this,null,function*(){const m=`https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(u)}&type=A`,a={Accept:"application/dns-json"};try{const e=yield r.http.get({url:m,headers:a}),t=JSON.parse(e.body);if(t.Status!==0)throw new Error(`HTTP error! status: ${t.Status}`);return t.Answer?t.Answer.map(n=>`${n.data}`)[0]:""}catch(e){return""}})}function L(u){return _(this,null,function*(){return yield r.http.get(`https://dns.google/resolve?name=${u}`).then(a=>{const e=JSON.parse(a.body);if(e.Status===0){const t=e.Answer.find(n=>n.type===1);return t?t.data:""}return""})})}function N(u){return _(this,null,function*(){return yield r.http.get(`http://ip-api.com/json/${u}?fields=country`).then(a=>JSON.parse(a.body).country||"")})}function T(u){return _(this,null,function*(){return yield r.http.get(`http://ip-api.com/json/${u}?fields=isp`).then(a=>JSON.parse(a.body).isp||"")})}function E(u){return _(this,null,function*(){return yield r.http.post({url:"http://ip-api.com/batch?fields=isp",body:JSON.stringify(u)}).then(a=>JSON.parse(a.body).map(t=>t.isp))})}function P(u,m){let a,e;const t=V(u);if((a=m.match(/^(.*?)\/(\d{1,2})$/))&&(e=V(a[1]))>=0){const n=i(2,32-parseInt(a[2]));return t>=e&&t<=e+n-1}return!1}function V(u){let m;if(m=u.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let a=0,e=1;for(let t=4;t>=1;t-=1)a+=e*parseInt(m[t]),e*=256;return a}return-1}},9085:(d,c,l)=>{l.d(c,{G:()=>i});function i(r){return r&&r!=="null"&&r!=="undefined"}function _(r,O){return r.reduce((s,p)=>{const o=p[O];return s[o]||(s[o]=[]),s[o].push(p),s},{})}},1058:(d,c,l)=>{l.d(c,{A:()=>i});function i(_){const r=_.lastIndexOf("/");return new RegExp(_.slice(1,r),_.slice(r+1))}}},M={};function S(d){var c=M[d];if(c!==void 0)return c.exports;var l=M[d]={exports:{}};return k[d](l,l.exports,S),l.exports}S.n=d=>{var c=d&&d.__esModule?()=>d.default:()=>d;return S.d(c,{a:c}),c},S.d=(d,c)=>{for(var l in c)S.o(c,l)&&!S.o(d,l)&&Object.defineProperty(d,l,{enumerable:!0,get:c[l]})},S.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(d){if(typeof window=="object")return window}}(),S.o=(d,c)=>Object.prototype.hasOwnProperty.call(d,c);var D={};(()=>{var d=S(3183),c=S.n(d),l=S(8475),i=S(9085),_=S(1058),r=S(1500),O=S(423);function s(e,t){e.type==="vmess"&&e.network==="ws"&&(e["ws-opts"]=e["ws-opts"]||{},e["ws-opts"].headers=e["ws-opts"].headers||{},e["ws-opts"].headers.Host=t),e.sni=t,(0,i.G)(e["skip-cert-verify"])||(e["skip-cert-verify"]=!0)}var p=Math.pow,o=(e,t,n)=>new Promise((y,f)=>{var C=I=>{try{A(n.next(I))}catch(h){f(h)}},g=I=>{try{A(n.throw(I))}catch(h){f(h)}},A=I=>I.done?y(I.value):Promise.resolve(I.value).then(C,g);A((n=n.apply(e,t)).next())});const v="#sub-store-cached-dns",w="#sub-store-cached-isp",L=7*24*60*60*1e3,N=new l.A(v,L),T=new l.A(w,L);function E(e){return o(this,null,function*(){const t=(g,A)=>(0,_.A)(g.regex).test(A.name),n=(g,A)=>g.ports.some(I=>I===A.port),y=(g,A)=>o(this,null,function*(){return(yield Promise.all(g.ips.map(h=>m(A.server,h)))).some(h=>h)}),f=(g,A)=>o(this,null,function*(){return(yield Promise.all(g.isps.map(h=>V(A.server,h)))).some(h=>h)}),C=yield(0,O.ru)();for(const g of e){let A="";for(const I in C){const h=C[I];if((0,i.G)(h)){if(I==="default"){A=h.sni;continue}if((0,i.G)(h.sni)&&(!(0,i.G)(h.skip)||!h.skip)){const b=[];if((0,i.G)(h.regex)&&b.push(t),(0,i.G)(h.ports)&&b.push(n),(0,i.G)(h.ips)&&b.push(y),(0,i.G)(h.isps)&&b.push(f),(yield P(b,h,g))||b.length===0){A=h.sni;break}}}}s(g,A)}return e})}function P(e,t,n){return o(this,null,function*(){return(yield Promise.all(e.map(f=>f(t,n)))).every(f=>f)})}function V(e,t){return o(this,null,function*(){let n=e;if((0,r.l0)(e)){const y=N.get(e);if(y)n=y;else{const f=yield(0,r.S9)(e);n=f,f&&N.set(e,f)}}return u(n,t)})}function u(e,t){return o(this,null,function*(){let n="";const y=T.get(e);return y?n=y:(n=yield(0,r.u6)(e),n&&T.set(e,n)),!!r.Dq[t].some(C=>RegExp(`${C}`,"i").test(n))})}function m(e,t){return o(this,null,function*(){let n=e;if((0,r.l0)(e)){const y=N.get(e);if(y)n=y;else{const f=yield(0,r.S9)(e);n=f,f&&N.set(e,f)}}return a(n,t)})}function a(e,t){if(!(0,r.qu)(e))return!1;if(t.indexOf("/")<0)return!!(e===t||(0,r.Vo)(e,t)&&(0,r.Mi)(t)==="*");let n,y;const f=(0,r.GQ)(e);if((n=t.match(/^(.*?)\/(\d{1,2})$/))&&(y=(0,r.GQ)(n[1]))>=0){const C=p(2,32-parseInt(n[2]));return f>=y&&f<=y+C-1}return!1}c().operator=E})()})();})();
