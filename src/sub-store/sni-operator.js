(()=>{(()=>{"use strict";var R={183:(u,l,f)=>{var _;typeof window!="undefined"?_=window:typeof f.g!="undefined"?_=f.g:typeof self!="undefined"?_=self:_={},u.exports=_}},I={};function y(u){var l=I[u];if(l!==void 0)return l.exports;var f=I[u]={exports:{}};return R[u](f,f.exports,y),f.exports}y.n=u=>{var l=u&&u.__esModule?()=>u.default:()=>u;return y.d(l,{a:l}),l},y.d=(u,l)=>{for(var f in l)y.o(l,f)&&!y.o(u,f)&&Object.defineProperty(u,f,{enumerable:!0,get:l[f]})},y.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(u){if(typeof window=="object")return window}}(),y.o=(u,l)=>Object.prototype.hasOwnProperty.call(u,l);var X={};(()=>{var u=y(183),l=y.n(u);const f=$substore;class _{constructor(s,t){this.key=s,this.expires=t;const n=f.read(s);n?this.resourceCache=JSON.parse(n):(this.resourceCache={},this._persist()),this._cleanup()}_cleanup(){let s=!1;const t=new Date().getTime();Object.keys(this.resourceCache).forEach(n=>{const r=this.resourceCache[n];(!r.time||t-r.time>this.expires)&&(delete this.resourceCache[n],f.delete(`#${n}`),s=!0)}),s&&this._persist()}revokeIds(s){let t=!1;for(const n of s)delete this.resourceCache[n],t=!0;t&&this._persist()}revokeAll(){this.resourceCache={},this._persist()}_persist(){f.write(JSON.stringify(this.resourceCache),this.key)}get(s){const t=this.resourceCache[s]&&this.resourceCache[s].time;return t&&new Date().getTime()-t<=this.expires?this.resourceCache[s].data:null}set(s,t){this.resourceCache[s]={time:new Date().getTime(),data:t},this._persist()}}const b=_;function d(e){return e&&e!=="null"&&e!=="undefined"}function $(e){const s=e.lastIndexOf("/");return new RegExp(e.slice(1,s),e.slice(s+1))}var M=Math.pow,w=(e,s,t)=>new Promise((n,r)=>{var a=o=>{try{p(t.next(o))}catch(i){r(i)}},m=o=>{try{p(t.throw(o))}catch(i){r(i)}},p=o=>o.done?n(o.value):Promise.resolve(o.value).then(a,m);p((t=t.apply(e,s)).next())});const C=$substore,F={viettel:["Viettel Group","VIETTEL","AS7552 Viettel Group","VIETEL-AS-AP"],vnpt:["Vietnam Posts and Telecommunications Group","VNPT","AS135905 VIETNAM POSTS AND TELECOMMUNICATIONS GROUP","VNPT-AS-VN"],mobifone:["MOBIFONE","Mobifone Corporation","AS131429 MOBIFONE Corporation","MOBIFONE-AS-VN"],fpt:["FPT Telecom Company","AS18403 FPT Telecom Company","FPT-AS-AP"],google:["Google LLC","Google Cloud","AS15169 Google LLC"]};function O(e){return!!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(e)}function L(e){return!!/^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)(\/([1-9]|[1-2][0-9]|3[0-2])){0,1}$/.test(e)}function V(e,s){const t=e.split("."),n=s.split(".");if(t.length<3||n.length<3)return!1;for(let r=0;r<3;r++)if(t[r]!==n[r])return!1;return!0}function D(e){const s=e.split(".");return s[s.length-1]}function E(e){return w(this,null,function*(){return yield C.http.get(`https://dns.google/resolve?name=${e}`).then(t=>{const n=JSON.parse(t.body);if(n.Status===0){const r=n.Answer.find(a=>a.type===1);return r?r.data:""}return""})})}function Q(e){return w(this,null,function*(){return yield C.http.get(`http://ip-api.com/json/${e}?fields=country`).then(t=>JSON.parse(t.body).country||"")})}function G(e){return w(this,null,function*(){return yield C.http.get(`http://ip-api.com/json/${e}?fields=isp`).then(t=>JSON.parse(t.body).isp||"")})}function W(e){return w(this,null,function*(){return yield C.http.post({url:"http://ip-api.com/batch?fields=isp",body:JSON.stringify(e)}).then(t=>JSON.parse(t.body).map(r=>r.isp))})}function Z(e,s){let t,n;const r=S(e);if((t=s.match(/^(.*?)\/(\d{1,2})$/))&&(n=S(t[1]))>=0){const a=M(2,32-parseInt(t[2]));return r>=n&&r<=n+a-1}return!1}function S(e){let s;if(s=e.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let t=0,n=1;for(let r=4;r>=1;r-=1)t+=n*parseInt(s[r]),n*=256;return t}return-1}var N=(e,s,t)=>new Promise((n,r)=>{var a=o=>{try{p(t.next(o))}catch(i){r(i)}},m=o=>{try{p(t.throw(o))}catch(i){r(i)}},p=o=>o.done?n(o.value):Promise.resolve(o.value).then(a,m);p((t=t.apply(e,s)).next())});function J(){return N(this,null,function*(){const e=yield produceArtifact({type:"file",name:"proxy_config"});return ProxyUtils.yaml.safeLoad(e)})}function ee(){return N(this,null,function*(){const e=yield produceArtifact({type:"file",name:"subscription_config"});return ProxyUtils.yaml.safeLoad(e)})}function A(e,s){e.type==="vmess"&&e.network==="ws"&&(e["ws-opts"]=e["ws-opts"]||{},e["ws-opts"].headers=e["ws-opts"].headers||{},e["ws-opts"].headers.Host=s),e.sni=s,d(e["skip-cert-verify"])||(e["skip-cert-verify"]=!0)}var U=Math.pow,g=(e,s,t)=>new Promise((n,r)=>{var a=o=>{try{p(t.next(o))}catch(i){r(i)}},m=o=>{try{p(t.throw(o))}catch(i){r(i)}},p=o=>o.done?n(o.value):Promise.resolve(o.value).then(a,m);p((t=t.apply(e,s)).next())});const j="#sub-store-cached-dns",H="#sub-store-cached-isp",T=7*24*60*60*1e3,P=new b(j,T),k=new b(H,T);function z(e){return g(this,null,function*(){const{ignoreRule:s,type:t}=$arguments,n=yield J(),r=(o,i)=>$(o.regex).test(i.name),a=(o,i)=>o.ports.some(h=>h===i.port),m=(o,i)=>g(this,null,function*(){return(yield Promise.all(o.ips.map(c=>Y(i.server,c)))).some(c=>c)}),p=(o,i)=>g(this,null,function*(){return(yield Promise.all(o.isps.map(c=>B(i.server,c)))).some(c=>c)});if(d(t))for(const o of e){const i=n[t];if(!d(i))break;const h=[];d(i.regex)&&h.push(r),d(i.ports)&&h.push(a),d(i.ips)&&h.push(m),d(i.isps)&&h.push(p),((yield x(h,i,o))||h.length===0)&&A(o,i.sni)}else for(const o of e){let i="";for(const h in n){const c=n[h];if(d(c)){if(h==="default"){i=c.sni;continue}if((!s||!/true/i.test(s))&&(!d(c.skip)||!c.skip)){const v=[];if(d(c.regex)&&v.push(r),d(c.ports)&&v.push(a),d(c.ips)&&v.push(m),d(c.isps)&&v.push(p),yield x(v,c,o)){i=c.sni;break}}}}A(o,i)}return e})}function x(e,s,t){return g(this,null,function*(){return(yield Promise.all(e.map(r=>r(s,t)))).every(r=>r)})}function B(e,s){return g(this,null,function*(){let t=e;if(O(e)){const n=P.get(e);if(n)t=n;else{const r=yield E(e);t=r,r&&P.set(e,r)}}return K(t,s)})}function K(e,s){return g(this,null,function*(){let t="";const n=k.get(e);return n?t=n:(t=yield G(e),t&&k.set(e,t)),!!F[s].some(a=>RegExp(`${a}`,"i").test(t))})}function Y(e,s){return g(this,null,function*(){let t=e;if(O(e)){const n=P.get(e);if(n)t=n;else{const r=yield E(e);t=r,r&&P.set(e,r)}}return q(t,s)})}function q(e,s){if(!L(e))return!1;if(s.indexOf("/")<0)return!!(e===s||V(e,s)&&D(s)==="*");let t,n;const r=S(e);if((t=s.match(/^(.*?)\/(\d{1,2})$/))&&(n=S(t[1]))>=0){const a=U(2,32-parseInt(t[2]));return r>=n&&r<=n+a-1}return!1}l().operator=z})()})();})();
