(()=>{(()=>{"use strict";var A={183:(c,l,f)=>{var h;typeof window!="undefined"?h=window:typeof f.g!="undefined"?h=f.g:typeof self!="undefined"?h=self:h={},c.exports=h}},S={};function d(c){var l=S[c];if(l!==void 0)return l.exports;var f=S[c]={exports:{}};return A[c](f,f.exports,d),f.exports}d.n=c=>{var l=c&&c.__esModule?()=>c.default:()=>c;return d.d(l,{a:l}),l},d.d=(c,l)=>{for(var f in l)d.o(l,f)&&!d.o(c,f)&&Object.defineProperty(c,f,{enumerable:!0,get:l[f]})},d.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(c){if(typeof window=="object")return window}}(),d.o=(c,l)=>Object.prototype.hasOwnProperty.call(c,l);var q={};(()=>{var c=d(183),l=d.n(c);const f=$substore;class h{constructor(n,t){this.key=n,this.expires=t;const s=f.read(n);s?this.resourceCache=JSON.parse(s):(this.resourceCache={},this._persist()),this._cleanup()}_cleanup(){let n=!1;const t=new Date().getTime();Object.keys(this.resourceCache).forEach(s=>{const r=this.resourceCache[s];(!r.time||t-r.time>this.expires)&&(delete this.resourceCache[s],f.delete(`#${s}`),n=!0)}),n&&this._persist()}revokeIds(n){let t=!1;for(const s of n)delete this.resourceCache[s],t=!0;t&&this._persist()}revokeAll(){this.resourceCache={},this._persist()}_persist(){f.write(JSON.stringify(this.resourceCache),this.key)}get(n){const t=this.resourceCache[n]&&this.resourceCache[n].time;return t&&new Date().getTime()-t<=this.expires?this.resourceCache[n].data:null}set(n,t){this.resourceCache[n]={time:new Date().getTime(),data:t},this._persist()}}const I=h;function m(e){return e&&e!=="null"&&e!=="undefined"}function k(e){const n=e.lastIndexOf("/");return new RegExp(e.slice(1,n),e.slice(n+1))}var x=Math.pow,w=(e,n,t)=>new Promise((s,r)=>{var p=o=>{try{i(t.next(o))}catch(a){r(a)}},_=o=>{try{i(t.throw(o))}catch(a){r(a)}},i=o=>o.done?s(o.value):Promise.resolve(o.value).then(p,_);i((t=t.apply(e,n)).next())});const g=$substore,R={viettel:["Viettel Group","VIETTEL","AS7552 Viettel Group","VIETEL-AS-AP"],vnpt:["Vietnam Posts and Telecommunications Group","VNPT","AS135905 VIETNAM POSTS AND TELECOMMUNICATIONS GROUP","VNPT-AS-VN"],mobifone:["MOBIFONE","Mobifone Corporation","AS131429 MOBIFONE Corporation","MOBIFONE-AS-VN"],fpt:["FPT Telecom Company","AS18403 FPT Telecom Company","FPT-AS-AP"]};function b(e){return!!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(e)}function $(e){return!!/^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)(\/([1-9]|[1-2][0-9]|3[0-2])){0,1}$/.test(e)}function M(e,n){const t=e.split("."),s=n.split(".");if(t.length<3||s.length<3)return!1;for(let r=0;r<3;r++)if(t[r]!==s[r])return!1;return!0}function F(e){const n=e.split(".");return n[n.length-1]}function O(e){return w(this,null,function*(){return yield g.http.get(`https://dns.google/resolve?name=${e}`).then(t=>{const s=JSON.parse(t.body);if(s.Status===0){const r=s.Answer.find(p=>p.type===1);return r?r.data:""}return""})})}function X(e){return w(this,null,function*(){return yield g.http.get(`http://ip-api.com/json/${e}?fields=country`).then(t=>JSON.parse(t.body).country||"")})}function V(e){return w(this,null,function*(){return yield g.http.get(`http://ip-api.com/json/${e}?fields=isp`).then(t=>JSON.parse(t.body).isp||"")})}function Q(e){return w(this,null,function*(){return yield g.http.post({url:"http://ip-api.com/batch?fields=isp",body:JSON.stringify(e)}).then(t=>JSON.parse(t.body).map(r=>r.isp))})}function W(e,n){let t,s;const r=C(e);if((t=n.match(/^(.*?)\/(\d{1,2})$/))&&(s=C(t[1]))>=0){const p=x(2,32-parseInt(t[2]));return r>=s&&r<=s+p-1}return!1}function C(e){let n;if(n=e.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let t=0,s=1;for(let r=4;r>=1;r-=1)t+=s*parseInt(n[r]),s*=256;return t}return-1}var E=(e,n,t)=>new Promise((s,r)=>{var p=o=>{try{i(t.next(o))}catch(a){r(a)}},_=o=>{try{i(t.throw(o))}catch(a){r(a)}},i=o=>o.done?s(o.value):Promise.resolve(o.value).then(p,_);i((t=t.apply(e,n)).next())});function D(){return E(this,null,function*(){const e=yield produceArtifact({type:"file",name:"proxy_config"});return ProxyUtils.yaml.safeLoad(e)})}function Z(){return E(this,null,function*(){const e=yield produceArtifact({type:"file",name:"subscription_config"});return ProxyUtils.yaml.safeLoad(e)})}function L(e,n){e.type==="vmess"&&e.network==="ws"&&(e["ws-opts"]=e["ws-opts"]||{},e["ws-opts"].headers=e["ws-opts"].headers||{},e["ws-opts"].headers.Host=n),e.sni=n,m(e["skip-cert-verify"])||(e["skip-cert-verify"]=!0)}var J=Math.pow,y=(e,n,t)=>new Promise((s,r)=>{var p=o=>{try{i(t.next(o))}catch(a){r(a)}},_=o=>{try{i(t.throw(o))}catch(a){r(a)}},i=o=>o.done?s(o.value):Promise.resolve(o.value).then(p,_);i((t=t.apply(e,n)).next())});const U="#sub-store-cached-dns",j="#sub-store-cached-isp",N=7*24*60*60*1e3,P=new I(U,N),T=new I(j,N);function G(e){return y(this,null,function*(){const{ignoreRule:n}=$arguments,t=yield D(),s=(i,o)=>k(i.regex).test(o.name),r=(i,o)=>i.ports.some(a=>a===o.port),p=(i,o)=>y(this,null,function*(){return(yield Promise.all(i.ips.map(u=>K(o.server,u)))).some(u=>u)}),_=(i,o)=>y(this,null,function*(){return(yield Promise.all(i.isps.map(u=>z(o.server,u)))).some(u=>u)});for(const i of e){let o="";for(const a in t){const u=t[a];if(m(u)){if(a==="default"){o=u.sni;continue}if((!n||!/true/i.test(n))&&(!m(u.skip)||!u.skip)){const v=[];if(m(u.regex)&&v.push(s),m(u.ports)&&v.push(r),m(u.ips)&&v.push(p),m(u.isps)&&v.push(_),yield H(v,u,i)){o=u.sni;break}}}}L(i,o)}return e})}function H(e,n,t){return y(this,null,function*(){return(yield Promise.all(e.map(r=>r(n,t)))).every(r=>r)})}function z(e,n){return y(this,null,function*(){let t=e;if(b(e)){const s=P.get(e);if(s)t=s;else{const r=yield O(e);t=r,r&&P.set(e,r)}}return B(t,n)})}function B(e,n){return y(this,null,function*(){let t="";const s=T.get(e);return s?t=s:(t=yield V(e),t&&T.set(e,t)),!!R[n].some(p=>RegExp(`${p}`,"i").test(t))})}function K(e,n){return y(this,null,function*(){let t=e;if(b(e)){const s=P.get(e);if(s)t=s;else{const r=yield O(e);t=r,r&&P.set(e,r)}}return Y(t,n)})}function Y(e,n){if(!$(e))return!1;if(n.indexOf("/")<0)return!!(e===n||M(e,n)&&F(n)==="*");let t,s;const r=C(e);if((t=n.match(/^(.*?)\/(\d{1,2})$/))&&(s=C(t[1]))>=0){const p=J(2,32-parseInt(t[2]));return r>=s&&r<=s+p-1}return!1}l().operator=G})()})();})();
