(()=>{(()=>{"use strict";var $={183:(c,u,l)=>{var h;typeof window!="undefined"?h=window:typeof l.g!="undefined"?h=l.g:typeof self!="undefined"?h=self:h={},c.exports=h}},I={};function d(c){var u=I[c];if(u!==void 0)return u.exports;var l=I[c]={exports:{}};return $[c](l,l.exports,d),l.exports}d.n=c=>{var u=c&&c.__esModule?()=>c.default:()=>c;return d.d(u,{a:u}),u},d.d=(c,u)=>{for(var l in u)d.o(u,l)&&!d.o(c,l)&&Object.defineProperty(c,l,{enumerable:!0,get:u[l]})},d.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(c){if(typeof window=="object")return window}}(),d.o=(c,u)=>Object.prototype.hasOwnProperty.call(c,u);var X={};(()=>{var c=d(183),u=d.n(c);const l=$substore;class h{constructor(r,e){this.key=r,this.expires=e;const s=l.read(r);s?this.resourceCache=JSON.parse(s):(this.resourceCache={},this._persist()),this._cleanup()}_cleanup(){let r=!1;const e=new Date().getTime();Object.keys(this.resourceCache).forEach(s=>{const n=this.resourceCache[s];(!n.time||e-n.time>this.expires)&&(delete this.resourceCache[s],l.delete(`#${s}`),r=!0)}),r&&this._persist()}revokeIds(r){let e=!1;for(const s of r)delete this.resourceCache[s],e=!0;e&&this._persist()}revokeAll(){this.resourceCache={},this._persist()}_persist(){l.write(JSON.stringify(this.resourceCache),this.key)}get(r){const e=this.resourceCache[r]&&this.resourceCache[r].time;return e&&new Date().getTime()-e<=this.expires?this.resourceCache[r].data:null}set(r,e){this.resourceCache[r]={time:new Date().getTime(),data:e},this._persist()}}const x=h;function v(t){return t&&t!=="null"&&t!=="undefined"}function R(t){const r=t.lastIndexOf("/");return new RegExp(t.slice(1,r),t.slice(r+1))}var M=Math.pow,g=(t,r,e)=>new Promise((s,n)=>{var p=o=>{try{a(e.next(o))}catch(i){n(i)}},_=o=>{try{a(e.throw(o))}catch(i){n(i)}},a=o=>o.done?s(o.value):Promise.resolve(o.value).then(p,_);a((e=e.apply(t,r)).next())});const w=$substore,k={viettel:["Viettel Group","VIETTEL","AS7552 Viettel Group","VIETEL-AS-AP"],vnpt:["Vietnam Posts and Telecommunications Group","VNPT","AS135905 VIETNAM POSTS AND TELECOMMUNICATIONS GROUP","VNPT-AS-VN"],mobifone:["MOBIFONE","Mobifone Corporation","AS131429 MOBIFONE Corporation","MOBIFONE-AS-VN"],fpt:["FPT Telecom Company","AS18403 FPT Telecom Company","FPT-AS-AP"]};function S(t){return!!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(t)}function F(t){return!!/^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)(\/([1-9]|[1-2][0-9]|3[0-2])){0,1}$/.test(t)}function V(t,r){const e=t.split("."),s=r.split(".");if(e.length<3||s.length<3)return!1;for(let n=0;n<3;n++)if(e[n]!==s[n])return!1;return!0}function L(t){const r=t.split(".");return r[r.length-1]}function O(t){return g(this,null,function*(){return yield w.http.get(`https://dns.google/resolve?name=${t}`).then(e=>{const s=JSON.parse(e.body);if(s.Status===0){const n=s.Answer.find(p=>p.type===1);return n?n.data:""}return""})})}function Q(t){return g(this,null,function*(){return yield w.http.get(`http://ip-api.com/json/${t}?fields=country`).then(e=>JSON.parse(e.body).country||"")})}function D(t){return g(this,null,function*(){return yield w.http.get(`http://ip-api.com/json/${t}?fields=isp`).then(e=>JSON.parse(e.body).isp||"")})}function W(t){return g(this,null,function*(){return yield w.http.post({url:"http://ip-api.com/batch?fields=isp",body:JSON.stringify(t)}).then(e=>JSON.parse(e.body).map(n=>n.isp))})}function Z(t,r){let e,s;const n=b(t);if((e=r.match(/^(.*?)\/(\d{1,2})$/))&&(s=b(e[1]))>=0){const p=M(2,32-parseInt(e[2]));return n>=s&&n<=s+p-1}return!1}function b(t){let r;if(r=t.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let e=0,s=1;for(let n=4;n>=1;n-=1)e+=s*parseInt(r[n]),s*=256;return e}return-1}var E=(t,r,e)=>new Promise((s,n)=>{var p=o=>{try{a(e.next(o))}catch(i){n(i)}},_=o=>{try{a(e.throw(o))}catch(i){n(i)}},a=o=>o.done?s(o.value):Promise.resolve(o.value).then(p,_);a((e=e.apply(t,r)).next())});function J(){return E(this,null,function*(){const t=yield produceArtifact({type:"file",name:"proxy_config"});return ProxyUtils.yaml.safeLoad(t)})}function ee(){return E(this,null,function*(){const t=yield produceArtifact({type:"file",name:"subscription_config"});return ProxyUtils.yaml.safeLoad(t)})}var U=Math.pow,y=(t,r,e)=>new Promise((s,n)=>{var p=o=>{try{a(e.next(o))}catch(i){n(i)}},_=o=>{try{a(e.throw(o))}catch(i){n(i)}},a=o=>o.done?s(o.value):Promise.resolve(o.value).then(p,_);a((e=e.apply(t,r)).next())});const j="#sub-store-cached-dns",G="#sub-store-cached-isp",T=7*24*60*60*1e3,C=new x(j,T),A=new x(G,T);function z(t){return y(this,null,function*(){const{type:r}=$arguments,e=yield J(),s=(i,f)=>R(i.regex).test(f.name),n=(i,f)=>i.ports.some(P=>P===f.port),p=(i,f)=>y(this,null,function*(){return(yield Promise.all(i.ips.map(m=>Y(f.server,m)))).some(m=>m)}),_=(i,f)=>y(this,null,function*(){return(yield Promise.all(i.isps.map(m=>H(f.server,m)))).some(m=>m)}),a=e[r],o=[];for(const i of t){const f=[];v(a.regex)&&f.push(s),v(a.ports)&&f.push(n),v(a.ips)&&f.push(p),v(a.isps)&&f.push(_),((yield B(f,a,i))||f.length===0)&&o.push(i)}return o})}function B(t,r,e){return y(this,null,function*(){return(yield Promise.all(t.map(n=>n(r,e)))).every(n=>n)})}function H(t,r){return y(this,null,function*(){let e=t;if(S(t)){const s=C.get(t);if(s)e=s;else{const n=yield O(t);e=n,n&&C.set(t,n)}}return K(e,r)})}function K(t,r){return y(this,null,function*(){let e="";const s=A.get(t);return s?e=s:(e=yield D(t),e&&A.set(t,e)),!!k[r].some(p=>RegExp(`${p}`,"i").test(e))})}function Y(t,r){return y(this,null,function*(){let e=t;if(S(t)){const s=C.get(t);if(s)e=s;else{const n=yield O(t);e=n,n&&C.set(t,n)}}return q(e,r)})}function q(t,r){if(!F(t))return!1;if(r.indexOf("/")<0)return!!(t===r||V(t,r)&&L(r)==="*");let e,s;const n=N(t);if((e=r.match(/^(.*?)\/(\d{1,2})$/))&&(s=N(e[1]))>=0){const p=U(2,32-parseInt(e[2]));return n>=s&&n<=s+p-1}return!1}function N(t){let r;if(r=t.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let e=0,s=1;for(let n=4;n>=1;n-=1)e+=s*parseInt(r[n]),s*=256;return e}return-1}u().operator=z})()})();})();
