(()=>{(()=>{"use strict";var P={183:(a,c,u)=>{var d;typeof window!="undefined"?d=window:typeof u.g!="undefined"?d=u.g:typeof self!="undefined"?d=self:d={},a.exports=d}},m={};function p(a){var c=m[a];if(c!==void 0)return c.exports;var u=m[a]={exports:{}};return P[a](u,u.exports,p),u.exports}p.n=a=>{var c=a&&a.__esModule?()=>a.default:()=>a;return p.d(c,{a:c}),c},p.d=(a,c)=>{for(var u in c)p.o(c,u)&&!p.o(a,u)&&Object.defineProperty(a,u,{enumerable:!0,get:c[u]})},p.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(a){if(typeof window=="object")return window}}(),p.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c);var U={};(()=>{var a=p(183),c=p.n(a);const u=$substore;class d{constructor(t,e){this.key=t,this.expires=e;const s=u.read(t);s?this.resourceCache=JSON.parse(s):(this.resourceCache={},this._persist()),this._cleanup()}_cleanup(){let t=!1;const e=new Date().getTime();Object.keys(this.resourceCache).forEach(s=>{const n=this.resourceCache[s];(!n.time||e-n.time>this.expires)&&(delete this.resourceCache[s],u.delete(`#${s}`),t=!0)}),t&&this._persist()}revokeIds(t){let e=!1;for(const s of t)delete this.resourceCache[s],e=!0;e&&this._persist()}revokeAll(){this.resourceCache={},this._persist()}_persist(){u.write(JSON.stringify(this.resourceCache),this.key)}get(t){const e=this.resourceCache[t]&&this.resourceCache[t].time;return e&&new Date().getTime()-e<=this.expires?this.resourceCache[t].data:null}set(t,e){this.resourceCache[t]={time:new Date().getTime(),data:e},this._persist()}}const $=d;function y(r){return r&&r!=="null"&&r!=="undefined"}function O(r){const t=r.lastIndexOf("/");return new RegExp(r.slice(1,t),r.slice(t+1))}var E=Math.pow,g=(r,t,e)=>new Promise((s,n)=>{var f=o=>{try{l(e.next(o))}catch(i){n(i)}},h=o=>{try{l(e.throw(o))}catch(i){n(i)}},l=o=>o.done?s(o.value):Promise.resolve(o.value).then(f,h);l((e=e.apply(r,t)).next())});const x=$substore;function R(r){return!!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(r)}function S(r){return!!/^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)(\/([1-9]|[1-2][0-9]|3[0-2])){0,1}$/.test(r)}function k(r,t){const e=r.split("."),s=t.split(".");if(e.length<3||s.length<3)return!1;for(let n=0;n<3;n++)if(e[n]!==s[n])return!1;return!0}function T(r){const t=r.split(".");return t[t.length-1]}function A(r){return g(this,null,function*(){return yield x.http.get(`https://dns.google/resolve?name=${r}`).then(e=>{const s=JSON.parse(e.body);if(s.Status===0){const n=s.Answer.find(f=>f.type===1);return n?n.data:""}return""})})}function V(r){return g(this,null,function*(){return yield x.http.get(`http://ip-api.com/json/${r}?fields=country`).then(e=>JSON.parse(e.body).country||"")})}function q(r,t){let e,s;const n=C(r);if((e=t.match(/^(.*?)\/(\d{1,2})$/))&&(s=C(e[1]))>=0){const f=E(2,32-parseInt(e[2]));return n>=s&&n<=s+f-1}return!1}function C(r){let t;if(t=r.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let e=0,s=1;for(let n=4;n>=1;n-=1)e+=s*parseInt(t[n]),s*=256;return e}return-1}var N=(r,t,e)=>new Promise((s,n)=>{var f=o=>{try{l(e.next(o))}catch(i){n(i)}},h=o=>{try{l(e.throw(o))}catch(i){n(i)}},l=o=>o.done?s(o.value):Promise.resolve(o.value).then(f,h);l((e=e.apply(r,t)).next())});function D(){return N(this,null,function*(){const r=yield produceArtifact({type:"file",name:"proxy_config"});return ProxyUtils.yaml.safeLoad(r)})}var M=Math.pow,_=(r,t,e)=>new Promise((s,n)=>{var f=o=>{try{l(e.next(o))}catch(i){n(i)}},h=o=>{try{l(e.throw(o))}catch(i){n(i)}},l=o=>o.done?s(o.value):Promise.resolve(o.value).then(f,h);l((e=e.apply(r,t)).next())});const j="#sub-store-cached-dns",F=7*24*60*60*1e3,b=new $(j,F);function J(r){return _(this,null,function*(){const{type:t}=$arguments,e=yield D(),s=(o,i)=>O(o.regex).test(i.name),n=(o,i)=>o.ports.some(v=>v===i.port),f=(o,i)=>_(this,null,function*(){return(yield Promise.all(o.ips.map(w=>L(i.server,w)))).some(w=>w)}),h=e[t],l=[];for(const o of r){const i=[];y(h.regex)&&i.push(s),y(h.ports)&&i.push(n),y(h.ips)&&i.push(f),(yield z(i,h,o))&&l.push(o)}return l})}function z(r,t,e){return _(this,null,function*(){return(yield Promise.all(r.map(n=>n(t,e)))).every(n=>n)})}function L(r,t){return _(this,null,function*(){let e=r;if(R(r)){const s=b.get(r);if(s)e=s;else{const n=yield A(r);e=n,n&&b.set(r,n)}}return H(e,t)})}function H(r,t){if(!S(r))return!1;if(t.indexOf("/")<0)return!!(r===t||k(r,t)&&T(t)==="*");let e,s;const n=I(r);if((e=t.match(/^(.*?)\/(\d{1,2})$/))&&(s=I(e[1]))>=0){const f=M(2,32-parseInt(e[2]));return n>=s&&n<=s+f-1}return!1}function I(r){let t;if(t=r.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let e=0,s=1;for(let n=4;n>=1;n-=1)e+=s*parseInt(t[n]),s*=256;return e}return-1}c().operator=J})()})();})();
