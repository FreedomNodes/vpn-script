(()=>{(()=>{"use strict";var b={183:(a,l,p)=>{var h;typeof window!="undefined"?h=window:typeof p.g!="undefined"?h=p.g:typeof self!="undefined"?h=self:h={},a.exports=h}},E={};function d(a){var l=E[a];if(l!==void 0)return l.exports;var p=E[a]={exports:{}};return b[a](p,p.exports,d),p.exports}d.n=a=>{var l=a&&a.__esModule?()=>a.default:()=>a;return d.d(l,{a:l}),l},d.d=(a,l)=>{for(var p in l)d.o(l,p)&&!d.o(a,p)&&Object.defineProperty(a,p,{enumerable:!0,get:l[p]})},d.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(a){if(typeof window=="object")return window}}(),d.o=(a,l)=>Object.prototype.hasOwnProperty.call(a,l);var X={};(()=>{var a=d(183),l=d.n(a);const p=$substore;class h{constructor(n,e){this.key=n,this.expires=e;const o=p.read(n);o?this.resourceCache=JSON.parse(o):(this.resourceCache={},this._persist()),this._cleanup()}_cleanup(){let n=!1;const e=new Date().getTime();Object.keys(this.resourceCache).forEach(o=>{const r=this.resourceCache[o];(!r.time||e-r.time>this.expires)&&(delete this.resourceCache[o],p.delete(`#${o}`),n=!0)}),n&&this._persist()}revokeIds(n){let e=!1;for(const o of n)delete this.resourceCache[o],e=!0;e&&this._persist()}revokeAll(){this.resourceCache={},this._persist()}_persist(){p.write(JSON.stringify(this.resourceCache),this.key)}get(n){const e=this.resourceCache[n]&&this.resourceCache[n].time;return e&&new Date().getTime()-e<=this.expires?this.resourceCache[n].data:null}set(n,e){this.resourceCache[n]={time:new Date().getTime(),data:e},this._persist()}}const v=h;function I(t){return t&&t!=="null"&&t!=="undefined"}function Q(t,n){return t.reduce((e,o)=>{const r=o[n];return e[r]||(e[r]=[]),e[r].push(o),e},{})}function x(t){const n=t.lastIndexOf("/");return new RegExp(t.slice(1,n),t.slice(n+1))}var M=Math.pow,g=(t,n,e)=>new Promise((o,r)=>{var c=s=>{try{u(e.next(s))}catch(i){r(i)}},m=s=>{try{u(e.throw(s))}catch(i){r(i)}},u=s=>s.done?o(s.value):Promise.resolve(s.value).then(c,m);u((e=e.apply(t,n)).next())});const S=$substore,R={viettel:["Viettel Group","VIETTEL","AS7552 Viettel Group","VIETEL-AS-AP"],vnpt:["Vietnam Posts and Telecommunications Group","VNPT","AS135905 VIETNAM POSTS AND TELECOMMUNICATIONS GROUP","VNPT-AS-VN"],mobifone:["MOBIFONE","Mobifone Corporation","AS131429 MOBIFONE Corporation","MOBIFONE-AS-VN"],fpt:["FPT Telecom Company","AS18403 FPT Telecom Company","FPT-AS-AP"],google:["Google LLC","Google Cloud","AS15169 Google LLC"],mcloud:["MCLOUD","1mcloud Technology Company Limited","S149078 VPSMMO TECHNOLOGY COMPANY LIMITED","VPSMMO-AS-VN"],gnetwork:["GNETWORK","Gnetwork Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],akamai:["Akamai Technologies","Linode","AS63949 Akamai Connected Cloud","AKAMAI-LINODE-AP"],cloviet:["CLOVIET","Cloud Viet ONE Member Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietDigital:["Viet Digital Technology Liability Company","Mailand Technology Trading Services Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietServer:["Vietserver Services Technology Company Limited","T-media Digital Technology Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],digitalOcean:["DigitalOcean, LLC","AS14061 DigitalOcean, LLC","DIGITALOCEAN-ASN"],cloudfly:["Cloudfly Corporation","AS149089 CLOUDFLY CORPORATION","CLOUDFLY-VN"]};function T(t){return!!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(t)}function D(t){return!!/^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)(\/([1-9]|[1-2][0-9]|3[0-2])){0,1}$/.test(t)}function $(t,n){const e=t.split("."),o=n.split(".");if(e.length<3||o.length<3)return!1;for(let r=0;r<3;r++)if(e[r]!==o[r])return!1;return!0}function k(t){const n=t.split(".");return n[n.length-1]}function Z(t){return g(this,null,function*(){const n=`https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(t)}&type=A`,e={Accept:"application/dns-json"};try{const o=yield S.http.get({url:n,headers:e}),r=JSON.parse(o.body);if(r.Status!==0)throw new Error(`HTTP error! status: ${r.Status}`);return r.Answer?r.Answer.map(c=>`${c.data}`)[0]:""}catch(o){return""}})}function w(t){return g(this,null,function*(){return yield S.http.get(`https://dns.google/resolve?name=${t}`).then(e=>{const o=JSON.parse(e.body);if(o.Status===0){const r=o.Answer.find(c=>c.type===1);return r?r.data:""}return""})})}function ee(t){return g(this,null,function*(){return yield S.http.get(`http://ip-api.com/json/${t}?fields=country`).then(e=>JSON.parse(e.body).country||"")})}function G(t){return g(this,null,function*(){return yield S.http.get(`http://ip-api.com/json/${t}?fields=isp`).then(e=>JSON.parse(e.body).isp||"")})}function te(t){return g(this,null,function*(){return yield S.http.post({url:"http://ip-api.com/batch?fields=isp",body:JSON.stringify(t)}).then(e=>JSON.parse(e.body).map(r=>r.isp))})}function ne(t,n){let e,o;const r=N(t);if((e=n.match(/^(.*?)\/(\d{1,2})$/))&&(o=N(e[1]))>=0){const c=M(2,32-parseInt(e[2]));return r>=o&&r<=o+c-1}return!1}function N(t){let n;if(n=t.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let e=0,o=1;for(let r=4;r>=1;r-=1)e+=o*parseInt(n[r]),o*=256;return e}return-1}var A=(t,n,e)=>new Promise((o,r)=>{var c=s=>{try{u(e.next(s))}catch(i){r(i)}},m=s=>{try{u(e.throw(s))}catch(i){r(i)}},u=s=>s.done?o(s.value):Promise.resolve(s.value).then(c,m);u((e=e.apply(t,n)).next())});function Y(){return A(this,null,function*(){const t=yield produceArtifact({type:"file",name:"proxy_config"});return ProxyUtils.yaml.safeLoad(t)})}function F(){return A(this,null,function*(){const t=yield produceArtifact({type:"file",name:"subscription_config"});return ProxyUtils.yaml.safeLoad(t)})}function re(t){return A(this,null,function*(){const n=normalizeString(t),e=yield F();let o="";for(const r in e)if(containsIgnoreCase(n,normalizeString(r))){o=r;break}return e[o]})}var U=Math.pow,y=(t,n,e)=>new Promise((o,r)=>{var c=s=>{try{u(e.next(s))}catch(i){r(i)}},m=s=>{try{u(e.throw(s))}catch(i){r(i)}},u=s=>s.done?o(s.value):Promise.resolve(s.value).then(c,m);u((e=e.apply(t,n)).next())});const H="#sub-store-cached-dns",J="#sub-store-cached-isp",L=7*24*60*60*1e3,_=new v(H,L),P=new v(J,L);function j(t){return y(this,null,function*(){const{type:n}=$arguments,e=yield Y(),o=(i,f)=>x(i.regex).test(f.name),r=(i,f)=>i.ports.some(O=>O===f.port),c=(i,f)=>y(this,null,function*(){return(yield Promise.all(i.ips.map(C=>q(f.server,C)))).some(C=>C)}),m=(i,f)=>y(this,null,function*(){return(yield Promise.all(i.isps.map(C=>z(f.server,C)))).some(C=>C)}),u=e[n],s=[];for(const i of t){const f=[];I(u.regex)&&f.push(o),I(u.ports)&&f.push(r),I(u.ips)&&f.push(c),I(u.isps)&&f.push(m),((yield B(f,u,i))||f.length===0)&&s.push(i)}return s})}function B(t,n,e){return y(this,null,function*(){return(yield Promise.all(t.map(r=>r(n,e)))).every(r=>r)})}function z(t,n){return y(this,null,function*(){let e=t;if(T(t)){const o=_.get(t);if(o)e=o;else{const r=yield w(t);e=r,r&&_.set(t,r)}}return K(e,n)})}function K(t,n){return y(this,null,function*(){let e="";const o=P.get(t);return o?e=o:(e=yield G(t),e&&P.set(t,e)),!!R[n].some(c=>RegExp(`${c}`,"i").test(e))})}function q(t,n){return y(this,null,function*(){let e=t;if(T(t)){const o=_.get(t);if(o)e=o;else{const r=yield w(t);e=r,r&&_.set(t,r)}}return W(e,n)})}function W(t,n){if(!D(t))return!1;if(n.indexOf("/")<0)return!!(t===n||$(t,n)&&k(n)==="*");let e,o;const r=V(t);if((e=n.match(/^(.*?)\/(\d{1,2})$/))&&(o=V(e[1]))>=0){const c=U(2,32-parseInt(e[2]));return r>=o&&r<=o+c-1}return!1}function V(t){let n;if(n=t.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let e=0,o=1;for(let r=4;r>=1;r-=1)e+=o*parseInt(n[r]),o*=256;return e}return-1}l().operator=j})()})();})();
