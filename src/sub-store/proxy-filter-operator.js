/*
 fullhash:8078244a1c44f8b1932e, chunkhash:9e203d23088f4560971e, file:sub-store/proxy-filter-operator.js
 author: Kien Tran
 */
(()=>{(()=>{"use strict";var k={3183:(_,p,o)=>{var m;typeof window!="undefined"?m=window:typeof o.g!="undefined"?m=o.g:typeof self!="undefined"?m=self:m={},_.exports=m},8475:(_,p,o)=>{o.d(p,{A:()=>c});const m=$substore;class a{constructor(e,u){this.key=e,this.expires=u;const s=m.read(e);s?this.resourceCache=JSON.parse(s):(this.resourceCache={},this._persist()),this._cleanup()}_cleanup(){let e=!1;const u=new Date().getTime();Object.keys(this.resourceCache).forEach(s=>{const C=this.resourceCache[s];(!C.time||u-C.time>this.expires)&&(delete this.resourceCache[s],m.delete(`#${s}`),e=!0)}),e&&this._persist()}revokeIds(e){let u=!1;for(const s of e)delete this.resourceCache[s],u=!0;u&&this._persist()}revokeAll(){this.resourceCache={},this._persist()}_persist(){m.write(JSON.stringify(this.resourceCache),this.key)}get(e){const u=this.resourceCache[e]&&this.resourceCache[e].time;return u&&new Date().getTime()-u<=this.expires?this.resourceCache[e].data:null}set(e,u){this.resourceCache[e]={time:new Date().getTime(),data:u},this._persist()}}const c=a},423:(_,p,o)=>{o.d(p,{ru:()=>a});var m=(e,u,s)=>new Promise((C,I)=>{var P=E=>{try{S(s.next(E))}catch(T){I(T)}},O=E=>{try{S(s.throw(E))}catch(T){I(T)}},S=E=>E.done?C(E.value):Promise.resolve(E.value).then(P,O);S((s=s.apply(e,u)).next())});function a(){return m(this,null,function*(){const e=yield produceArtifact({type:"file",name:"proxy_config"});return ProxyUtils.yaml.safeLoad(e)})}function c(){return m(this,null,function*(){const e=yield produceArtifact({type:"file",name:"subscription_config"});return ProxyUtils.yaml.safeLoad(e)})}function v(e){return m(this,null,function*(){const u=normalizeString(e),s=yield c();let C="";for(const I in s)if(containsIgnoreCase(u,normalizeString(I))){C=I;break}return s[C]})}},1500:(_,p,o)=>{o.d(p,{Dq:()=>v,Mi:()=>C,S9:()=>P,Vo:()=>s,l0:()=>e,qu:()=>u,sY:()=>S,u6:()=>E});var m=Math.pow,a=(d,y,l)=>new Promise((f,h)=>{var w=t=>{try{M(l.next(t))}catch(n){h(n)}},R=t=>{try{M(l.throw(t))}catch(n){h(n)}},M=t=>t.done?f(t.value):Promise.resolve(t.value).then(w,R);M((l=l.apply(d,y)).next())});const c=$substore,v={viettel:["Viettel Group","VIETTEL","AS7552 Viettel Group","VIETEL-AS-AP"],vnpt:["Vietnam Posts and Telecommunications Group","VNPT","AS135905 VIETNAM POSTS AND TELECOMMUNICATIONS GROUP","VNPT-AS-VN"],mobifone:["MOBIFONE","Mobifone Corporation","AS131429 MOBIFONE Corporation","MOBIFONE-AS-VN"],fpt:["FPT Telecom Company","AS18403 FPT Telecom Company","FPT-AS-AP"],google:["Google LLC","Google Cloud","AS15169 Google LLC"],mcloud:["MCLOUD","1mcloud Technology Company Limited","S149078 VPSMMO TECHNOLOGY COMPANY LIMITED","VPSMMO-AS-VN"],gnetwork:["GNETWORK","Gnetwork Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],akamai:["Akamai Technologies","Linode","AS63949 Akamai Connected Cloud","AKAMAI-LINODE-AP"],cloviet:["CLOVIET","Cloud Viet ONE Member Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietDigital:["Viet Digital Technology Liability Company","Mailand Technology Trading Services Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietServer:["Vietserver Services Technology Company Limited","T-media Digital Technology Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],digitalOcean:["DigitalOcean, LLC","AS14061 DigitalOcean, LLC","DIGITALOCEAN-ASN"],cloudfly:["Cloudfly Corporation","AS149089 CLOUDFLY CORPORATION","CLOUDFLY-VN"]};function e(d){return!!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(d)}function u(d){return!!/^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)(\/([1-9]|[1-2][0-9]|3[0-2])){0,1}$/.test(d)}function s(d,y){const l=d.split("."),f=y.split(".");if(l.length<3||f.length<3)return!1;for(let h=0;h<3;h++)if(l[h]!==f[h])return!1;return!0}function C(d){const y=d.split(".");return y[y.length-1]}function I(d){return a(this,null,function*(){const y=`https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(d)}&type=A`,l={Accept:"application/dns-json"};try{const f=yield c.http.get({url:y,headers:l}),h=JSON.parse(f.body);if(h.Status!==0)throw new Error(`HTTP error! status: ${h.Status}`);return h.Answer?h.Answer.map(w=>`${w.data}`)[0]:""}catch(f){return""}})}function P(d){return a(this,null,function*(){return yield c.http.get(`https://dns.google/resolve?name=${d}`).then(l=>{const f=JSON.parse(l.body);if(f.Status===0){const h=f.Answer.find(w=>w.type===1);return h?h.data:""}return""})})}function O(d){return a(this,null,function*(){return yield c.http.get(`http://ip-api.com/json/${d}?fields=country`).then(l=>JSON.parse(l.body).country||"")})}function S(d){return a(this,null,function*(){return yield c.http.get(`http://ip-api.com/json/${d}?fields=region,regionName`).then(l=>{const f=JSON.parse(l.body);return f.regionName&&f.region?`${f.regionName} (${f.region})`:""})})}function E(d){return a(this,null,function*(){return yield c.http.get(`http://ip-api.com/json/${d}?fields=isp`).then(l=>JSON.parse(l.body).isp||"")})}function T(d){return a(this,null,function*(){return yield c.http.post({url:"http://ip-api.com/batch?fields=isp",body:JSON.stringify(d)}).then(l=>JSON.parse(l.body).map(h=>h.isp))})}function x(d,y){let l,f;const h=V(d);if((l=y.match(/^(.*?)\/(\d{1,2})$/))&&(f=V(l[1]))>=0){const w=m(2,32-parseInt(l[2]));return h>=f&&h<=f+w-1}return!1}function V(d){let y;if(y=d.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let l=0,f=1;for(let h=4;h>=1;h-=1)l+=f*parseInt(y[h]),f*=256;return l}return-1}},9085:(_,p,o)=>{o.d(p,{G:()=>m});function m(c){return c&&c!=="null"&&c!=="undefined"}function a(c,v){return c.reduce((e,u)=>{const s=u[v];return e[s]||(e[s]=[]),e[s].push(u),e},{})}},4173:(_,p,o)=>{o.d(p,{$S:()=>y,Ck:()=>x,Hd:()=>d,eD:()=>V,um:()=>l,xG:()=>T});var m=o(1058),a=o(1500),c=o(8475),v=Math.pow,e=(t,n,i)=>new Promise((r,g)=>{var L=D=>{try{b(i.next(D))}catch(G){g(G)}},N=D=>{try{b(i.throw(D))}catch(G){g(G)}},b=D=>D.done?r(D.value):Promise.resolve(D.value).then(L,N);b((i=i.apply(t,n)).next())});const u="#sub-store-cached-dns",s="#sub-store-cached-isp",C="#sub-store-cached-region",I=7*24*60*60*1e3,P=new c.A(u,I),O=new c.A(s,I),S=new c.A(C,I);function E(t,n){t.type==="vmess"&&t.network==="ws"&&(t["ws-opts"]=t["ws-opts"]||{},t["ws-opts"].headers=t["ws-opts"].headers||{},t["ws-opts"].headers.Host=n),t.sni=n,isRealValue(t["skip-cert-verify"])||(t["skip-cert-verify"]=!0)}function T(t,n){return(0,m.r)(t.regex).test(n.name)}function x(t,n){return t.ports.some(i=>i===n.port)}function V(t,n){return e(this,null,function*(){return(yield Promise.all(t.ips.map(r=>w(n.server,r)))).some(r=>r)})}function d(t,n){return e(this,null,function*(){return(yield Promise.all(t.isps.map(r=>h(n.server,r)))).some(r=>r)})}function y(t,n){return e(this,null,function*(){return(yield Promise.all(t.regions.map(r=>f(n.server,r)))).some(r=>r)})}function l(t,n,i){return e(this,null,function*(){return(yield Promise.all(t.map(g=>g(n,i)))).every(g=>g)})}function f(t,n){return e(this,null,function*(){const i=yield R(t);try{let r="";const g=S.get(i);g?r=g:(r=yield(0,a.sY)(i),r&&S.set(i,r));const L=(0,m.Z)(r);if(L){const{name:N,code:b}=L;if(n.toLowerCase()===N.toLowerCase()||n.toLowerCase()===b.toLowerCase())return!0}}catch(r){return!1}return!1})}function h(t,n){return e(this,null,function*(){const i=yield R(t);let r="";const g=O.get(i);return g?r=g:(r=yield(0,a.u6)(i),r&&O.set(i,r)),!!a.Dq[n].some(N=>RegExp(`${N}`,"i").test(r))})}function w(t,n){return e(this,null,function*(){const i=yield R(t);if(!(0,a.qu)(i))return!1;if(n.indexOf("/")<0)return!!(i===n||(0,a.Vo)(i,n)&&(0,a.Mi)(n)==="*");let r,g;const L=M(i);if((r=n.match(/^(.*?)\/(\d{1,2})$/))&&(g=M(r[1]))>=0){const N=v(2,32-parseInt(r[2]));return L>=g&&L<=g+N-1}return!1})}function R(t){return e(this,null,function*(){let n=t;if((0,a.l0)(t)){const i=P.get(t);if(i)n=i;else{const r=yield(0,a.S9)(t);n=r,r&&P.set(t,r)}}return n})}function M(t){let n;if(n=t.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let i=0,r=1;for(let g=4;g>=1;g-=1)i+=r*parseInt(n[g]),r*=256;return i}return-1}},1058:(_,p,o)=>{o.d(p,{Z:()=>a,r:()=>m});function m(c){const v=c.lastIndexOf("/");return new RegExp(c.slice(1,v),c.slice(v+1))}function a(c){const v=/^([^\(]+) \(([^)]+)\)$/,e=c.match(v);return e?{name:e[1].trim(),code:e[2]}:null}}},$={};function A(_){var p=$[_];if(p!==void 0)return p.exports;var o=$[_]={exports:{}};return k[_](o,o.exports,A),o.exports}A.n=_=>{var p=_&&_.__esModule?()=>_.default:()=>_;return A.d(p,{a:p}),p},A.d=(_,p)=>{for(var o in p)A.o(p,o)&&!A.o(_,o)&&Object.defineProperty(_,o,{enumerable:!0,get:p[o]})},A.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(_){if(typeof window=="object")return window}}(),A.o=(_,p)=>Object.prototype.hasOwnProperty.call(_,p);var U={};(()=>{var _=A(3183),p=A.n(_),o=A(9085),m=A(423),a=A(4173),c=(e,u,s)=>new Promise((C,I)=>{var P=E=>{try{S(s.next(E))}catch(T){I(T)}},O=E=>{try{S(s.throw(E))}catch(T){I(T)}},S=E=>E.done?C(E.value):Promise.resolve(E.value).then(P,O);S((s=s.apply(e,u)).next())});function v(e){return c(this,null,function*(){const{type:u}=$arguments,s=yield(0,m.ru)(),C=(0,o.G)(u)?s[u]:s[e[0].collectionName];if(!(0,o.G)(C))return e;const I=[];for(const P of e){const O=[];if((0,o.G)(C.regex)&&O.push(a.xG),(0,o.G)(C.ports)&&O.push(a.Ck),(0,o.G)(C.ips)&&O.push(a.eD),(0,o.G)(C.isps)&&O.push(a.Hd),(0,o.G)(C.regions)&&O.push(a.$S),O.length===0){I.push(P);continue}(yield(0,a.um)(O,C,P))&&I.push(P)}return I})}p().operator=v})()})();})();
