/*
 fullhash:344ad5fb64a5d7471216, chunkhash:3aa72afd71583f5a1762, file:sub-store/proxy-filter-operator.js
 author: Kien Tran
 */
(()=>{(()=>{"use strict";var x={183:(d,u,p)=>{var c;typeof window!="undefined"?c=window:typeof p.g!="undefined"?c=p.g:typeof self!="undefined"?c=self:c={},d.exports=c},475:(d,u,p)=>{p.d(u,{A:()=>s});const c=$substore;class m{constructor(r,o){this.key=r,this.expires=o;const f=c.read(r);f?this.resourceCache=JSON.parse(f):(this.resourceCache={},this._persist()),this._cleanup()}_cleanup(){let r=!1;const o=new Date().getTime();Object.keys(this.resourceCache).forEach(f=>{const O=this.resourceCache[f];(!O.time||o-O.time>this.expires)&&(delete this.resourceCache[f],c.delete(`#${f}`),r=!0)}),r&&this._persist()}revokeIds(r){let o=!1;for(const f of r)delete this.resourceCache[f],o=!0;o&&this._persist()}revokeAll(){this.resourceCache={},this._persist()}_persist(){c.write(JSON.stringify(this.resourceCache),this.key)}get(r){const o=this.resourceCache[r]&&this.resourceCache[r].time;return o&&new Date().getTime()-o<=this.expires?this.resourceCache[r].data:null}set(r,o){this.resourceCache[r]={time:new Date().getTime(),data:o},this._persist()}}const s=m},423:(d,u,p)=>{p.d(u,{ru:()=>m});var c=(r,o,f)=>new Promise((O,T)=>{var v=I=>{try{w(f.next(I))}catch(M){T(M)}},b=I=>{try{w(f.throw(I))}catch(M){T(M)}},w=I=>I.done?O(I.value):Promise.resolve(I.value).then(v,b);w((f=f.apply(r,o)).next())});function m(){return c(this,null,function*(){const r=yield produceArtifact({type:"file",name:"proxy_config"});return ProxyUtils.yaml.safeLoad(r)})}function s(){return c(this,null,function*(){const r=yield produceArtifact({type:"file",name:"subscription_config"});return ProxyUtils.yaml.safeLoad(r)})}function P(r){return c(this,null,function*(){const o=normalizeString(r),f=yield s();let O="";for(const T in f)if(containsIgnoreCase(o,normalizeString(T))){O=T;break}return f[O]})}},500:(d,u,p)=>{p.d(u,{Dq:()=>P,Mi:()=>O,S9:()=>v,Vo:()=>f,l0:()=>r,qu:()=>o,u6:()=>w});var c=Math.pow,m=(l,h,a)=>new Promise((e,t)=>{var n=C=>{try{i(a.next(C))}catch(L){t(L)}},_=C=>{try{i(a.throw(C))}catch(L){t(L)}},i=C=>C.done?e(C.value):Promise.resolve(C.value).then(n,_);i((a=a.apply(l,h)).next())});const s=$substore,P={viettel:["Viettel Group","VIETTEL","AS7552 Viettel Group","VIETEL-AS-AP"],vnpt:["Vietnam Posts and Telecommunications Group","VNPT","AS135905 VIETNAM POSTS AND TELECOMMUNICATIONS GROUP","VNPT-AS-VN"],mobifone:["MOBIFONE","Mobifone Corporation","AS131429 MOBIFONE Corporation","MOBIFONE-AS-VN"],fpt:["FPT Telecom Company","AS18403 FPT Telecom Company","FPT-AS-AP"],google:["Google LLC","Google Cloud","AS15169 Google LLC"],mcloud:["MCLOUD","1mcloud Technology Company Limited","S149078 VPSMMO TECHNOLOGY COMPANY LIMITED","VPSMMO-AS-VN"],gnetwork:["GNETWORK","Gnetwork Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],akamai:["Akamai Technologies","Linode","AS63949 Akamai Connected Cloud","AKAMAI-LINODE-AP"],cloviet:["CLOVIET","Cloud Viet ONE Member Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietDigital:["Viet Digital Technology Liability Company","Mailand Technology Trading Services Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietServer:["Vietserver Services Technology Company Limited","T-media Digital Technology Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],digitalOcean:["DigitalOcean, LLC","AS14061 DigitalOcean, LLC","DIGITALOCEAN-ASN"],cloudfly:["Cloudfly Corporation","AS149089 CLOUDFLY CORPORATION","CLOUDFLY-VN"]};function r(l){return!!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(l)}function o(l){return!!/^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)(\/([1-9]|[1-2][0-9]|3[0-2])){0,1}$/.test(l)}function f(l,h){const a=l.split("."),e=h.split(".");if(a.length<3||e.length<3)return!1;for(let t=0;t<3;t++)if(a[t]!==e[t])return!1;return!0}function O(l){const h=l.split(".");return h[h.length-1]}function T(l){return m(this,null,function*(){const h=`https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(l)}&type=A`,a={Accept:"application/dns-json"};try{const e=yield s.http.get({url:h,headers:a}),t=JSON.parse(e.body);if(t.Status!==0)throw new Error(`HTTP error! status: ${t.Status}`);return t.Answer?t.Answer.map(n=>`${n.data}`)[0]:""}catch(e){return""}})}function v(l){return m(this,null,function*(){return yield s.http.get(`https://dns.google/resolve?name=${l}`).then(a=>{const e=JSON.parse(a.body);if(e.Status===0){const t=e.Answer.find(n=>n.type===1);return t?t.data:""}return""})})}function b(l){return m(this,null,function*(){return yield s.http.get(`http://ip-api.com/json/${l}?fields=country`).then(a=>JSON.parse(a.body).country||"")})}function w(l){return m(this,null,function*(){return yield s.http.get(`http://ip-api.com/json/${l}?fields=isp`).then(a=>JSON.parse(a.body).isp||"")})}function I(l){return m(this,null,function*(){return yield s.http.post({url:"http://ip-api.com/batch?fields=isp",body:JSON.stringify(l)}).then(a=>JSON.parse(a.body).map(t=>t.isp))})}function M(l,h){let a,e;const t=D(l);if((a=h.match(/^(.*?)\/(\d{1,2})$/))&&(e=D(a[1]))>=0){const n=c(2,32-parseInt(a[2]));return t>=e&&t<=e+n-1}return!1}function D(l){let h;if(h=l.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let a=0,e=1;for(let t=4;t>=1;t-=1)a+=e*parseInt(h[t]),e*=256;return a}return-1}},85:(d,u,p)=>{p.d(u,{G:()=>c});function c(s){return s&&s!=="null"&&s!=="undefined"}function m(s,P){return s.reduce((r,o)=>{const f=o[P];return r[f]||(r[f]=[]),r[f].push(o),r},{})}},58:(d,u,p)=>{p.d(u,{A:()=>c});function c(m){const s=m.lastIndexOf("/");return new RegExp(m.slice(1,s),m.slice(s+1))}}},R={};function y(d){var u=R[d];if(u!==void 0)return u.exports;var p=R[d]={exports:{}};return x[d](p,p.exports,y),p.exports}y.n=d=>{var u=d&&d.__esModule?()=>d.default:()=>d;return y.d(u,{a:u}),u},y.d=(d,u)=>{for(var p in u)y.o(u,p)&&!y.o(d,p)&&Object.defineProperty(d,p,{enumerable:!0,get:u[p]})},y.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(d){if(typeof window=="object")return window}}(),y.o=(d,u)=>Object.prototype.hasOwnProperty.call(d,u);var G={};(()=>{var d=y(183),u=y.n(d),p=y(475),c=y(85),m=y(58),s=y(500),P=y(423),r=Math.pow,o=(e,t,n)=>new Promise((_,i)=>{var C=A=>{try{S(n.next(A))}catch(E){i(E)}},L=A=>{try{S(n.throw(A))}catch(E){i(E)}},S=A=>A.done?_(A.value):Promise.resolve(A.value).then(C,L);S((n=n.apply(e,t)).next())});const f="#sub-store-cached-dns",O="#sub-store-cached-isp",T=7*24*60*60*1e3,v=new p.A(f,T),b=new p.A(O,T);function w(e){return o(this,null,function*(){const{type:t}=$arguments,n=(E,g)=>(0,m.A)(E.regex).test(g.name),_=(E,g)=>E.ports.some(V=>V===g.port),i=(E,g)=>o(this,null,function*(){return(yield Promise.all(E.ips.map(N=>l(g.server,N)))).some(N=>N)}),C=(E,g)=>o(this,null,function*(){return(yield Promise.all(E.isps.map(N=>M(g.server,N)))).some(N=>N)}),L=yield(0,P.ru)(),S=(0,c.G)(t)?L[t]:L[e[0].collectionName];if(!(0,c.G)(S))return e;const A=[];for(const E of e){const g=[];if((0,c.G)(S.regex)&&g.push(n),(0,c.G)(S.ports)&&g.push(_),(0,c.G)(S.ips)&&g.push(i),(0,c.G)(S.isps)&&g.push(C),g.length===0){A.push(E);continue}(yield I(g,S,E))&&A.push(E)}return A})}function I(e,t,n){return o(this,null,function*(){return(yield Promise.all(e.map(i=>i(t,n)))).every(i=>i)})}function M(e,t){return o(this,null,function*(){let n=e;if((0,s.l0)(e)){const _=v.get(e);if(_)n=_;else{const i=yield(0,s.S9)(e);n=i,i&&v.set(e,i)}}return D(n,t)})}function D(e,t){return o(this,null,function*(){let n="";const _=b.get(e);return _?n=_:(n=yield(0,s.u6)(e),n&&b.set(e,n)),!!s.Dq[t].some(C=>RegExp(`${C}`,"i").test(n))})}function l(e,t){return o(this,null,function*(){let n=e;if((0,s.l0)(e)){const _=v.get(e);if(_)n=_;else{const i=yield(0,s.S9)(e);n=i,i&&v.set(e,i)}}return h(n,t)})}function h(e,t){if(!(0,s.qu)(e))return!1;if(t.indexOf("/")<0)return!!(e===t||(0,s.Vo)(e,t)&&(0,s.Mi)(t)==="*");let n,_;const i=a(e);if((n=t.match(/^(.*?)\/(\d{1,2})$/))&&(_=a(n[1]))>=0){const C=r(2,32-parseInt(n[2]));return i>=_&&i<=_+C-1}return!1}function a(e){let t;if(t=e.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let n=0,_=1;for(let i=4;i>=1;i-=1)n+=_*parseInt(t[i]),_*=256;return n}return-1}u().operator=w})()})();})();
