/*
 fullhash:164ad9a81da617ed8b41, chunkhash:b639fbc870f2d7465a0c, file:sub-store/set-sni.js
 author: Kien Tran
 */
(()=>{(()=>{"use strict";var v={3183:(o,i,c)=>{var f;typeof window!="undefined"?f=window:typeof c.g!="undefined"?f=c.g:typeof self!="undefined"?f=self:f={},o.exports=f}},y={};function l(o){var i=y[o];if(i!==void 0)return i.exports;var c=y[o]={exports:{}};return v[o](c,c.exports,l),c.exports}l.n=o=>{var i=o&&o.__esModule?()=>o.default:()=>o;return l.d(i,{a:i}),i},l.d=(o,i)=>{for(var c in i)l.o(i,c)&&!l.o(o,c)&&Object.defineProperty(o,c,{enumerable:!0,get:i[c]})},l.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(o){if(typeof window=="object")return window}}(),l.o=(o,i)=>Object.prototype.hasOwnProperty.call(o,i);var F={};(()=>{var o=l(3183),i=l.n(o);function c(e){return e&&e!=="null"&&e!=="undefined"}function f(e,n){return e.reduce((t,r)=>{const s=r[n];return t[s]||(t[s]=[]),t[s].push(r),t},{})}var w=Math.pow,m=(e,n,t)=>new Promise((r,s)=>{var u=a=>{try{p(t.next(a))}catch(d){s(d)}},g=a=>{try{p(t.throw(a))}catch(d){s(d)}},p=a=>a.done?r(a.value):Promise.resolve(a.value).then(u,g);p((t=t.apply(e,n)).next())});const C=null,G={viettel:["Viettel Group","VIETTEL","AS7552 Viettel Group","VIETEL-AS-AP"],vnpt:["Vietnam Posts and Telecommunications Group","VNPT","AS135905 VIETNAM POSTS AND TELECOMMUNICATIONS GROUP","VNPT-AS-VN"],mobifone:["MOBIFONE","Mobifone Corporation","AS131429 MOBIFONE Corporation","MOBIFONE-AS-VN"],fpt:["FPT Telecom Company","AS18403 FPT Telecom Company","FPT-AS-AP"],google:["Google LLC","Google Cloud","AS15169 Google LLC"],mcloud:["MCLOUD","1mcloud Technology Company Limited","S149078 VPSMMO TECHNOLOGY COMPANY LIMITED","VPSMMO-AS-VN"],gnetwork:["GNETWORK","Gnetwork Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],akamai:["Akamai Technologies","Linode","AS63949 Akamai Connected Cloud","AKAMAI-LINODE-AP"],cloviet:["CLOVIET","Cloud Viet ONE Member Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietDigital:["Viet Digital Technology Liability Company","Mailand Technology Trading Services Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietServer:["Vietserver Services Technology Company Limited","T-media Digital Technology Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],digitalOcean:["DigitalOcean, LLC","AS14061 DigitalOcean, LLC","DIGITALOCEAN-ASN"],cloudfly:["Cloudfly Corporation","AS149089 CLOUDFLY CORPORATION","CLOUDFLY-VN"]};function Y(e){return!!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(e)}function x(e){return!!/^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)(\/([1-9]|[1-2][0-9]|3[0-2])){0,1}$/.test(e)}function H(e,n){const t=e.split("."),r=n.split(".");if(t.length<3||r.length<3)return!1;for(let s=0;s<3;s++)if(t[s]!==r[s])return!1;return!0}function J(e){const n=e.split(".");return n[n.length-1]}function U(e){return m(this,null,function*(){const n=`https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(e)}&type=A`,t={Accept:"application/dns-json"};try{const r=yield C.http.get({url:n,headers:t}),s=JSON.parse(r.body);if(s.Status!==0)throw new Error(`HTTP error! status: ${s.Status}`);return s.Answer?s.Answer.map(u=>`${u.data}`)[0]:""}catch(r){return""}})}function j(e){return m(this,null,function*(){return yield C.http.get(`https://dns.google/resolve?name=${e}`).then(t=>{const r=JSON.parse(t.body);if(r.Status===0){const s=r.Answer.find(u=>u.type===1);return s?s.data:""}return""})})}function B(e){return m(this,null,function*(){return yield C.http.get(`http://ip-api.com/json/${e}?fields=country`).then(t=>JSON.parse(t.body).country||"")})}function K(e){return m(this,null,function*(){return yield C.http.get(`http://ip-api.com/json/${e}?fields=isp`).then(t=>JSON.parse(t.body).isp||"")})}function q(e){return m(this,null,function*(){return yield C.http.post({url:"http://ip-api.com/batch?fields=isp",body:JSON.stringify(e)}).then(t=>JSON.parse(t.body).map(s=>s.isp))})}function z(e,n){let t,r;const s=O(e);if((t=n.match(/^(.*?)\/(\d{1,2})$/))&&(r=O(t[1]))>=0){const u=w(2,32-parseInt(t[2]));return s>=r&&s<=r+u-1}return!1}function O(e){let n;if(n=e.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let t=0,r=1;for(let s=4;s>=1;s-=1)t+=r*parseInt(n[s]),r*=256;return t}return-1}const S=$substore;class N{constructor(n,t){this.key=n,this.expires=t;const r=S.read(n);r?this.resourceCache=JSON.parse(r):(this.resourceCache={},this._persist()),this._cleanup()}_cleanup(){let n=!1;const t=new Date().getTime();Object.keys(this.resourceCache).forEach(r=>{const s=this.resourceCache[r];(!s.time||t-s.time>this.expires)&&(delete this.resourceCache[r],S.delete(`#${r}`),n=!0)}),n&&this._persist()}revokeIds(n){let t=!1;for(const r of n)delete this.resourceCache[r],t=!0;t&&this._persist()}revokeAll(){this.resourceCache={},this._persist()}_persist(){S.write(JSON.stringify(this.resourceCache),this.key)}get(n){const t=this.resourceCache[n]&&this.resourceCache[n].time;return t&&new Date().getTime()-t<=this.expires?this.resourceCache[n].data:null}set(n,t){this.resourceCache[n]={time:new Date().getTime(),data:t},this._persist()}}const _=N;var L=Math.pow,h=(e,n,t)=>new Promise((r,s)=>{var u=a=>{try{p(t.next(a))}catch(d){s(d)}},g=a=>{try{p(t.throw(a))}catch(d){s(d)}},p=a=>a.done?r(a.value):Promise.resolve(a.value).then(u,g);p((t=t.apply(e,n)).next())});const P="#sub-store-cached-dns",V="#sub-store-cached-isp",A=7*24*60*60*1e3,I=new _(P,A),E=new _(V,A);function D(e,n){e.type==="vmess"&&e.network==="ws"&&(e["ws-opts"]=e["ws-opts"]||{},e["ws-opts"].headers=e["ws-opts"].headers||{},e["ws-opts"].headers.Host=n),e.sni=n,c(e["skip-cert-verify"])||(e["skip-cert-verify"]=!0)}const W=(e,n)=>parseRegex(e.regex).test(n.name),X=(e,n)=>e.ports.some(t=>t===n.port),Q=(e,n)=>h(void 0,null,function*(){return(yield Promise.all(e.ips.map(r=>R(n.server,r)))).some(r=>r)}),Z=(e,n)=>h(void 0,null,function*(){return(yield Promise.all(e.isps.map(r=>M(n.server,r)))).some(r=>r)});function ee(e,n,t){return h(this,null,function*(){return(yield Promise.all(e.map(s=>s(n,t)))).every(s=>s)})}function M(e,n){return h(this,null,function*(){let t=e;if(isDomain(e)){const r=I.get(e);if(r)t=r;else{const s=yield getIpFromDomain(e);t=s,s&&I.set(e,s)}}return b(t,n)})}function b(e,n){return h(this,null,function*(){let t="";const r=E.get(e);return r?t=r:(t=yield getISPFromIp(e),t&&E.set(e,t)),!!ISP[n].some(u=>RegExp(`${u}`,"i").test(t))})}function R(e,n){return h(this,null,function*(){let t=e;if(isDomain(e)){const r=I.get(e);if(r)t=r;else{const s=yield getIpFromDomain(e);t=s,s&&I.set(e,s)}}return k(t,n)})}function k(e,n){if(!isValidIpAddress(e))return!1;if(n.indexOf("/")<0)return!!(e===n||areFirstThreePartsEqual(e,n)&&getLastPartOfIP(n)==="*");let t,r;const s=T(e);if((t=n.match(/^(.*?)\/(\d{1,2})$/))&&(r=T(t[1]))>=0){const u=L(2,32-parseInt(t[2]));return s>=r&&s<=r+u-1}return!1}function T(e){let n;if(n=e.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let t=0,r=1;for(let s=4;s>=1;s-=1)t+=r*parseInt(n[s]),r*=256;return t}return-1}function $(e){const{sni:n}=$arguments;return e.map(t=>(D(t,n),t))}i().operator=$})()})();})();
