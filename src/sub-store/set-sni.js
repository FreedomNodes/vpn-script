/*
 fullhash:f475625b8b5986c47489, chunkhash:7523686916b633fbf112, file:sub-store/set-sni.js
 author: Kien Tran
 */
(()=>{(()=>{"use strict";var N={3183:(i,a,c)=>{var m;typeof window!="undefined"?m=window:typeof c.g!="undefined"?m=c.g:typeof self!="undefined"?m=self:m={},i.exports=m}},O={};function l(i){var a=O[i];if(a!==void 0)return a.exports;var c=O[i]={exports:{}};return N[i](c,c.exports,l),c.exports}l.n=i=>{var a=i&&i.__esModule?()=>i.default:()=>i;return l.d(a,{a}),a},l.d=(i,a)=>{for(var c in a)l.o(a,c)&&!l.o(i,c)&&Object.defineProperty(i,c,{enumerable:!0,get:a[c]})},l.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(i){if(typeof window=="object")return window}}(),l.o=(i,a)=>Object.prototype.hasOwnProperty.call(i,a);var k={};(()=>{var i=l(3183),a=l.n(i);function c(t){return t&&t!=="null"&&t!=="undefined"}function m(t,r){return t.reduce((e,n)=>{const o=n[r];return e[o]||(e[o]=[]),e[o].push(n),e},{})}var L=Math.pow,C=(t,r,e)=>new Promise((n,o)=>{var s=u=>{try{d(e.next(u))}catch(h){o(h)}},p=u=>{try{d(e.throw(u))}catch(h){o(h)}},d=u=>u.done?n(u.value):Promise.resolve(u.value).then(s,p);d((e=e.apply(t,r)).next())});const g=null,H={viettel:["Viettel Group","VIETTEL","AS7552 Viettel Group","VIETEL-AS-AP"],vnpt:["Vietnam Posts and Telecommunications Group","VNPT","AS135905 VIETNAM POSTS AND TELECOMMUNICATIONS GROUP","VNPT-AS-VN"],mobifone:["MOBIFONE","Mobifone Corporation","AS131429 MOBIFONE Corporation","MOBIFONE-AS-VN"],fpt:["FPT Telecom Company","AS18403 FPT Telecom Company","FPT-AS-AP"],google:["Google LLC","Google Cloud","AS15169 Google LLC"],mcloud:["MCLOUD","1mcloud Technology Company Limited","S149078 VPSMMO TECHNOLOGY COMPANY LIMITED","VPSMMO-AS-VN"],gnetwork:["GNETWORK","Gnetwork Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],akamai:["Akamai Technologies","Linode","AS63949 Akamai Connected Cloud","AKAMAI-LINODE-AP"],cloviet:["CLOVIET","Cloud Viet ONE Member Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietDigital:["Viet Digital Technology Liability Company","Mailand Technology Trading Services Company Limited","AS135918 VIET DIGITAL TECHNOLOGY LIABILITY COMPANY","DVS-AS-VN"],vietServer:["Vietserver Services Technology Company Limited","T-media Digital Technology Company Limited","AS63737 VIETSERVER SERVICES TECHNOLOGY COMPANY LIMITED","VIETSERVER-AS-VN"],digitalOcean:["DigitalOcean, LLC","AS14061 DigitalOcean, LLC","DIGITALOCEAN-ASN"],cloudfly:["Cloudfly Corporation","AS149089 CLOUDFLY CORPORATION","CLOUDFLY-VN"]};function x(t){return!!/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(t)}function J(t){return!!/^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)(\/([1-9]|[1-2][0-9]|3[0-2])){0,1}$/.test(t)}function U(t,r){const e=t.split("."),n=r.split(".");if(e.length<3||n.length<3)return!1;for(let o=0;o<3;o++)if(e[o]!==n[o])return!1;return!0}function j(t){const r=t.split(".");return r[r.length-1]}function B(t){return C(this,null,function*(){const r=`https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(t)}&type=A`,e={Accept:"application/dns-json"};try{const n=yield g.http.get({url:r,headers:e}),o=JSON.parse(n.body);if(o.Status!==0)throw new Error(`HTTP error! status: ${o.Status}`);return o.Answer?o.Answer.map(s=>`${s.data}`)[0]:""}catch(n){return""}})}function K(t){return C(this,null,function*(){return yield g.http.get(`https://dns.google/resolve?name=${t}`).then(e=>{const n=JSON.parse(e.body);if(n.Status===0){const o=n.Answer.find(s=>s.type===1);return o?o.data:""}return""})})}function q(t){return C(this,null,function*(){return yield g.http.get(`http://ip-api.com/json/${t}?fields=country`).then(e=>JSON.parse(e.body).country||"")})}function z(t){return C(this,null,function*(){return yield g.http.get(`http://ip-api.com/json/${t}?fields=region,regionName`).then(e=>{const n=JSON.parse(e.body);return`${n.regionName} (${n.region})`||""})})}function W(t){return C(this,null,function*(){return yield g.http.get(`http://ip-api.com/json/${t}?fields=isp`).then(e=>JSON.parse(e.body).isp||"")})}function X(t){return C(this,null,function*(){return yield g.http.post({url:"http://ip-api.com/batch?fields=isp",body:JSON.stringify(t)}).then(e=>JSON.parse(e.body).map(o=>o.isp))})}function Q(t,r){let e,n;const o=_(t);if((e=r.match(/^(.*?)\/(\d{1,2})$/))&&(n=_(e[1]))>=0){const s=L(2,32-parseInt(e[2]));return o>=n&&o<=n+s-1}return!1}function _(t){let r;if(r=t.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let e=0,n=1;for(let o=4;o>=1;o-=1)e+=n*parseInt(r[o]),n*=256;return e}return-1}const I=$substore;class P{constructor(r,e){this.key=r,this.expires=e;const n=I.read(r);n?this.resourceCache=JSON.parse(n):(this.resourceCache={},this._persist()),this._cleanup()}_cleanup(){let r=!1;const e=new Date().getTime();Object.keys(this.resourceCache).forEach(n=>{const o=this.resourceCache[n];(!o.time||e-o.time>this.expires)&&(delete this.resourceCache[n],I.delete(`#${n}`),r=!0)}),r&&this._persist()}revokeIds(r){let e=!1;for(const n of r)delete this.resourceCache[n],e=!0;e&&this._persist()}revokeAll(){this.resourceCache={},this._persist()}_persist(){I.write(JSON.stringify(this.resourceCache),this.key)}get(r){const e=this.resourceCache[r]&&this.resourceCache[r].time;return e&&new Date().getTime()-e<=this.expires?this.resourceCache[r].data:null}set(r,e){this.resourceCache[r]={time:new Date().getTime(),data:e},this._persist()}}const S=P;var V=Math.pow,f=(t,r,e)=>new Promise((n,o)=>{var s=u=>{try{d(e.next(u))}catch(h){o(h)}},p=u=>{try{d(e.throw(u))}catch(h){o(h)}},d=u=>u.done?n(u.value):Promise.resolve(u.value).then(s,p);d((e=e.apply(t,r)).next())});const R="#sub-store-cached-dns",D="#sub-store-cached-isp",M="#sub-store-cached-region",y=7*24*60*60*1e3,A=new S(R,y),w=new S(D,y),v=new S(M,y);function b(t,r){t.type==="vmess"&&t.network==="ws"&&(t["ws-opts"]=t["ws-opts"]||{},t["ws-opts"].headers=t["ws-opts"].headers||{},t["ws-opts"].headers.Host=r),t.sni=r,c(t["skip-cert-verify"])||(t["skip-cert-verify"]=!0)}function Z(t,r){return parseRegex(t.regex).test(r.name)}function ee(t,r){return t.ports.some(e=>e===r.port)}function te(t,r){return f(this,null,function*(){return(yield Promise.all(t.ips.map(n=>G(r.server,n)))).some(n=>n)})}function ne(t,r){return f(this,null,function*(){return(yield Promise.all(t.isps.map(n=>F(r.server,n)))).some(n=>n)})}function re(t,r){return f(this,null,function*(){return(yield Promise.all(t.regions.map(n=>$(r.server,n)))).some(n=>n)})}function oe(t,r,e){return f(this,null,function*(){return(yield Promise.all(t.map(o=>o(r,e)))).every(o=>o)})}function $(t,r){return f(this,null,function*(){const e=E(t);let n="";const o=v.get(e);o?n=o:(n=yield getRegionFromIp(e),n&&v.set(e,n));const s=parseNameAndCode(n);if(s){const{name:p,code:d}=s;if(r.toLowerCase()===p.toLowerCase()||r.toLowerCase()===d.toLowerCase())return!0}return!1})}function F(t,r){return f(this,null,function*(){const e=E(t);let n="";const o=w.get(e);return o?n=o:(n=yield getISPFromIp(e),n&&w.set(e,n)),!!ISP[r].some(p=>RegExp(`${p}`,"i").test(n))})}function G(t,r){return f(this,null,function*(){const e=E(t);if(!isValidIpAddress(e))return!1;if(r.indexOf("/")<0)return!!(e===r||areFirstThreePartsEqual(e,r)&&getLastPartOfIP(r)==="*");let n,o;const s=T(e);if((n=r.match(/^(.*?)\/(\d{1,2})$/))&&(o=T(n[1]))>=0){const p=V(2,32-parseInt(n[2]));return s>=o&&s<=o+p-1}return!1})}function E(t){return f(this,null,function*(){let r=t;if(isDomain(t)){const e=A.get(t);if(e)r=e;else{const n=yield getIpFromDomain(t);r=n,n&&A.set(t,n)}}return r})}function T(t){let r;if(r=t.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){let e=0,n=1;for(let o=4;o>=1;o-=1)e+=n*parseInt(r[o]),n*=256;return e}return-1}function Y(t){const{sni:r}=$arguments;return t.map(e=>(b(e,r),e))}a().operator=Y})()})();})();
